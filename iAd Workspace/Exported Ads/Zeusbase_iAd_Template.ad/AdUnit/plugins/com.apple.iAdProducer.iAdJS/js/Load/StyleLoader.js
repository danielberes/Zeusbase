
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.StyleLoader",superclass:iAd.Loader});iAd.StyleLoader.DEFAULT_TIMEOUT=0;iAd.StyleLoader.LOAD_EVENT_SUPPORT_DETECTED=false;iAd.StyleLoader.prototype.startLoad=function(){var a=this._element=document.createElement("link");a.rel="stylesheet";a.href=this._url;if(iAd.CSS.isStyleSheetLoaded(this.resolvedURL)){this._element=iAd.CSS.elementForStyleSheet(this.resolvedURL);this.notifyLoaderDidComplete();return}this.addElementListeners();if(!iAd.StyleLoader.LOAD_EVENT_SUPPORT_DETECTED){iAd.StyleLoader.enqueueStyleLoader(this)}document.head.appendChild(a)};iAd.StyleLoader.prototype.abortLoad=function(){if(this._element){this.removeElementListeners();document.head.removeChild(this._element);iAd.StyleLoader.dequeueStyleLoader(this)}};iAd.StyleLoader.prototype.getSupportingObject=function(){return this._element};iAd.StyleLoader.prototype.getResolvedURL=function(){return this._element?this._element.href:this.callSuper()};iAd.StyleLoader.prototype.addElementListeners=function(a){this._element.addEventListener("load",this);this._element.addEventListener("error",this)};iAd.StyleLoader.prototype.removeElementListeners=function(a){this._element.removeEventListener("load",this);this._element.removeEventListener("error",this)};iAd.StyleLoader.prototype.handleEvent=function(a){iAd.StyleLoader.LOAD_EVENT_SUPPORT_DETECTED=true;iAd.StyleLoader.dequeueStyleLoader(this);this.removeElementListeners();switch(a.type){case"load":if(!this.loaded){this.notifyLoaderDidComplete()}break;case"error":this.notifyLoaderDidFail();break}};iAd.StyleLoader.stylesheetsLoadingQueue={};iAd.StyleLoader.stylesheetsLoadPoller=null;iAd.StyleLoader.enqueueStyleLoader=function(b){var c=b.resolvedURL;var a=iAd.StyleLoader.stylesheetsLoadingQueue;if(a.hasOwnProperty(c)){a[c].push(b)}else{a[c]=[b]}if(iAd.StyleLoader.stylesheetsLoadPoller==null){iAd.StyleLoader.stylesheetsLoadPoller=window.setInterval(iAd.StyleLoader.pollStylesheetLoad,50)}};iAd.StyleLoader.dequeueStyleLoader=function(b){var a=iAd.StyleLoader.stylesheetsLoadingQueue;var c=b.resolvedURL;if(a.hasOwnProperty(c)){iAd.Array.removeObjectFromArray(b,a[c])}if(a[c]&&a[c].length==0){delete a[c]}if(iAd.StyleLoader.stylesheetsLoadPoller&&Object.keys(a).length==0){iAd.StyleLoader.stopPolling()}};iAd.StyleLoader.pollStylesheetLoad=function(){var a=iAd.StyleLoader.stylesheetsLoadingQueue;if(iAd.StyleLoader.LOAD_EVENT_SUPPORT_DETECTED){iAd.StyleLoader.stylesheetsLoadingQueue={};iAd.StyleLoader.stopPolling();return}for(var b in a){if(iAd.CSS.isStyleSheetLoaded(b)){a[b].forEach(function(c){c.notifyLoaderDidComplete()});delete a[b]}}if(Object.keys(a).length==0){iAd.StyleLoader.stopPolling()}};iAd.StyleLoader.stopPolling=function(){window.clearInterval(iAd.StyleLoader.stylesheetsLoadPoller);iAd.StyleLoader.stylesheetsLoadPoller=null};