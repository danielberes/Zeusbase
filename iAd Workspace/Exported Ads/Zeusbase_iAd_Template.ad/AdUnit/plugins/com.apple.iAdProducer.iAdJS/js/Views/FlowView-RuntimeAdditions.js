
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

(function(){iAd.Class.processMethod(iAd.FlowView,"layerWasInsertedIntoDocument");iAd.Class.processMethod(iAd.FlowView,"handleEvent");iAd.Class.processMethod(iAd.FlowView,"layerWasCreated");var a=iAd.FlowView.prototype.layerWasInsertedIntoDocument;var c=iAd.FlowView.prototype.handleEvent;var b=iAd.FlowView.prototype.layerWasCreated;iAd.FlowView.prototype.layerWasInsertedIntoDocument=function(){a.apply(this,arguments);this.setSize(this.size);document.body.addEventListener("webkitbeginfullscreen",this,true)};iAd.FlowView.prototype.layerWasRemovedFromDocument=function(){this.callSuper();document.body.removeEventListener("webkitbeginfullscreen",this,true)};iAd.FlowView.prototype.handleEvent=function(){if(event.type=="webkitbeginfullscreen"){this.forceRedraw()}c.apply(this,arguments)};iAd.FlowView.prototype.layerWasCreated=function(){b.apply(this,arguments);this.mask=document.createElement("div");this.mask3d=document.createElement("div");this.mask3d.addClassName("ad-flow-view-mask3d");this.mask3d.appendChild(this.camera);this.mask.addClassName("ad-flow-view-mask");this.mask.appendChild(this.mask3d);this.layer.appendChild(this.mask)};iAd.FlowView.prototype.setSize=function(d){this.callSuper(d);this.cellSize=new iAd.Size(d.height,d.height);this.updateCellsLayout();this.mask3d.style.height=d.height+"px";this.mask3d.style.width=d.width+"px";this.mask.style.height=(d.height+200)+"px";this.mask.style.width=d.width+"px"}})();(function(){iAd.Class.processMethod(iAd.FlowView,"init");var b=iAd.FlowView.prototype.init;iAd.FlowView.prototype.init=function(){b.apply(this,arguments);if(!iAP.Context.IS_IOS&&iAP.Context.projectIsOfType("iTunesProject")&&!iAP.Context.IS_IAD_PRODUCER){this._trackCamera=false;this.layer.addEventListener("mousewheel",this,false)}};iAd.Class.processMethod(iAd.FlowView,"handleEvent");var d=iAd.FlowView.prototype.handleEvent;iAd.FlowView.prototype.handleEvent=function(e){if(e.type=="mousewheel"){this.handleMousewheel(e)}d.apply(this,arguments)};var a=iAd.Class.runtimeMethodOverride(iAd.FlowView,"touchesBegan",function(){this.clearMousewheel();var e=event.target;while(e&&!e.hasClassName("ad-flow-view-cell")){if(e.parentNode==document){return}e=e.parentNode}a.apply(this,arguments)});var c=iAd.Class.runtimeMethodOverride(iAd.FlowView,"focusCellAtIndexAnimated",function(){this.clearMousewheel();c.apply(this,arguments)})})();iAd.FlowView.prototype.clearMousewheel=function(){if(this._scrolling){this._scrollingTimer&&clearTimeout(this._scrollingTimer);delete this._scrolling;delete this._scrollingPreviousIndex;this._scrollingCumulativeDelta=0;this.dispatchNotification(iAd.FlowView.DID_END_SWIPE_NOTIFICATION,this.delegate)}};iAd.FlowView.prototype.handleMousewheel=function(c){if(Math.abs(c.wheelDeltaX)<Math.abs(c.wheelDeltaY)){return}c.preventDefault();var d=c.wheelDeltaX;if(!this._scrolling){this._scrolling=true;this._scrollingPreviousIndex=this.focusedIndex;this._scrollingCumulativeDelta=0;this.dispatchNotification(iAd.FlowView.DID_BEGIN_SWIPE_NOTIFICATION,this.delegate)}else{if((d<0&&this._scrollingCumulativeDelta>0)||(d>0&&this._scrollingCumulativeDelta<0)){this._scrollingPreviousIndex=this.focusedIndex;this._scrollingCumulativeDelta=0}}this._scrollingTimer&&clearTimeout(this._scrollingTimer);this._scrollingTimer=setTimeout((function(){delete this._scrolling;delete this._scrollingPreviousIndex;this._scrollingCumulativeDelta=0;this.dispatchNotification(iAd.FlowView.DID_END_SWIPE_NOTIFICATION,this.delegate)}).bind(this),100);this._scrollingCumulativeDelta+=d;var a=this._scrollingCumulativeDelta/this._cellGap;if(d>0&&a%1>0.25){a=Math.ceil(a)}else{if(d<0&&a%1<0.75){a=Math.floor(a)}else{a=Math.round(a)}}var b=this._scrollingPreviousIndex-a;b=iAd.Number.clampValue(b,0,this.numberOfCells-1);if(b!=this._focusedIndex){this._scrolling=false;this.focusCellAtIndexAnimated(b,true);this._scrolling=true}};