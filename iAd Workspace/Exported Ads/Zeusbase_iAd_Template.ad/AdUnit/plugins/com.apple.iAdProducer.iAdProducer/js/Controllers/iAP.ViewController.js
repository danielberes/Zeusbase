
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAP.ViewController",superclass:iAd.ViewController,synthesizedProperties:["readyToTransition","nextViewController","autoAdvanceToNextViewController","autoAdvanceCondition","minimumDelayBeforeTransition"],archivedProperties:["readyToTransition","nextViewController","autoAdvanceToNextViewController","autoAdvanceCondition","minimumDelayBeforeTransition"]});iAP.ViewController.ORIENTATION_UNKNOWN=0;iAP.ViewController.ORIENTATION_PORTRAIT=1;iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT=3;iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT=4;iAP.ViewController.VIEW_DID_SHAKE="viewControllerViewDidShake";iAP.ViewController.ITUNES_PLAYBACK_WILL_START="viewControllerITunesPlaybackWillStart";iAP.ViewController.ITUNES_PLAYBACK_DID_START="viewControllerITunesPlaybackDidStart";iAP.ViewController.ITUNES_DID_SEEK="viewControllerITunesDidSeek";iAP.ViewController.ITUNES_PLAYBACK_DID_PAUSE="viewControllerITunesPlaybackDidPause";iAP.ViewController.ITUNES_PLAYBACK_DID_END="viewControllerITunesPlaybackDidEnd";iAP.ViewController.ITUNES_PLAYBACK_DID_ERROR="viewControllerITunesPlaybackDidError";iAP.ViewController.ITUNES_PLAYING_TRACK_INFO_DID_CHANGE="viewControllerITunesPlayingTrackInfoDidChange";iAP.ViewController.ITUNES_VOLUME_DID_CHANGE="viewControllerITunesVolumeDidChange";iAP.ViewController.ITUNES_VIDEO_DID_CLOSE="viewControllerITunesVideoDidClose";iAP.ViewController.iTunesEventMap={play:iAP.ViewController.ITUNES_PLAYBACK_WILL_START,playing:iAP.ViewController.ITUNES_PLAYBACK_DID_START,timeupdate:iAP.ViewController.ITUNES_DID_SEEK,pause:iAP.ViewController.ITUNES_PLAYBACK_DID_PAUSE,ended:iAP.ViewController.ITUNES_PLAYBACK_DID_END,error:iAP.ViewController.ITUNES_PLAYBACK_DID_ERROR,playingtrackchanged:iAP.ViewController.ITUNES_PLAYING_TRACK_INFO_DID_CHANGE,volumechange:iAP.ViewController.ITUNES_VOLUME_DID_CHANGE,videoclosed:iAP.ViewController.ITUNES_VIDEO_DID_CLOSE};iAd.ViewController.TRANSITION_IN_FROM_RIGHT=function(b){var a=b.size.width;return{properties:["transform"],from:["translateX("+a+"px)"],to:["translateX(0)"]}};iAd.ViewController.TRANSITION_IN_FROM_LEFT=function(b){var a=-b.size.width;return{properties:["transform"],from:["translateX("+a+"px)"],to:["translateX(0)"]}};iAd.ViewController.TRANSITION_OUT_TO_RIGHT=function(b){var a=b.size.width;return{properties:["transform"],from:["translateX(0)"],to:["translateX("+a+"px)"]}};iAd.ViewController.TRANSITION_OUT_TO_LEFT=function(b){var a=-b.size.width;return{properties:["transform"],from:["translateX(0)"],to:["translateX("+a+"px)"]}};iAP.ViewController.prototype.init=function(a){this.buildInActionListShouldDelayTransition=true;this.nextViewControllerID=null;this._autoAdvanceToNextViewController=false;this._autoAdvanceCondition="no-activity";this._minimumDelayBeforeTransition=0;this._loadingTimeoutDuration=3;this._autoAdvanceToNextViewControllerOnTimeout=false;this.callSuper(a);if(!this.configuration.properties){this.configuration.properties={}}var l=this;Object.defineProperty(this.configuration.properties,"autoAdvanceToNextViewController",{get:function(){iAd.Console.warn('Checking "viewController.configuration.properties.autoAdvanceToNextViewController" is no longer supported. Use "viewController.autoAdvanceToNextViewController" instead.');return l.autoAdvanceToNextViewController},set:function(i){iAd.Console.warn('Setting "viewController.configuration.properties.autoAdvanceToNextViewController" is no longer supported. Use "viewController.autoAdvanceToNextViewController" instead.');l.autoAdvanceToNextViewController=i;return l.autoAdvanceToNextViewController}});this._readyToTransition=false;this._shouldPreloadNextViewControllers=true;this._orientationCode=iAP.ViewController.ORIENTATION_UNKNOWN;this._additionalImages=[];this.becomesReadyToTransitionWhenViewsAreLoaded=true;this.viewControllerContainers=[];if(a.isBackgroundLayer){this.view.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.view.resizeWithOldSuperviewSize(this.view.size)}var j=iAP.EventDelegate.viewControllerScriptFunctions[a.id];if(j){var d=new iAP.EventDelegate(this,this,j);d.processUserScript()}var k=null;if(this.transitionDuration){k=parseFloat(this.transitionDuration)}var b=["wasBackItemTransition","becomesBackItemTransition","wasTopItemTransition","becomesTopItemTransition","becomesHiddenTransition"];for(var c=0,f=b.length;c<f;c++){var e=b[c];var g=this[e];if(g){if(k>0){if(iAd.Utils.objectIsFunction(g)){this[e]=(function(i){return function(m){var n=i(m);n.revertsToOriginalValues=true;n.duration=k;return n}})(g)}else{var h={};iAd.Utils.copyPropertiesFromSourceToTarget(g,h);this[e]=g=h;g.revertsToOriginalValues=true;g.duration=k}}else{this[e]=null}}}if(!!iAd.Device.iOS_VERSION){document.addEventListener("focus",this,true);document.addEventListener("blur",this,true)}};iAP.ViewController.prototype.loadView=function(){if(this.configuration.isBackgroundLayer){this.view=iAd.View.getViewById(this.id);this.__visible=false}else{this.callSuper()}};iAP.ViewController.prototype.clearScrollToTopTimer=function(){if(this._scrollToTopTimer){clearTimeout(this._scrollToTopTimer);this._scrollToTopTimer=null}};iAP.ViewController.prototype.clearAutoAdvanceTimer=function(){if(this._autoAdvanceTimer){clearTimeout(this._autoAdvanceTimer);this._autoAdvanceTimer=null}};iAP.ViewController.prototype.handleEvent=function(b){var a=b.type;if(a==iAd.Device.SHAKE_EVENT){this.createAndDispatchEvent(iAP.ViewController.VIEW_DID_SHAKE)}else{if(a=="orientationchange"&&this.orientation==iAP.ViewController.ORIENTATION_UNKNOWN){if(window.orientation==0){this.setOrientation(iAP.ViewController.ORIENTATION_PORTRAIT)}else{if(window.orientation==-90){this.setOrientation(iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT)}else{if(window.orientation==180){this.setOrientation(iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN)}else{if(window.orientation==90){this.setOrientation(iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT)}}}}}else{if(a=="focus"&&this.contentView){this.contentView.layer.style.overflow="hidden";this.clearScrollToTopTimer()}else{if(a=="blur"&&this.contentView){this.contentView.layer.style.overflow="visible";if(!iAd.Device.iOSVersionLessThan("5.0")){this.clearScrollToTopTimer();this._scrollToTopTimer=setTimeout(function(){window.scrollTo(0,0)},100)}}}}}if(this._autoAdvanceToNextViewController){if(a==iAd.Event.START_EVENT){this.clearAutoAdvanceTimer();window.addEventListener(iAd.Event.END_EVENT,this,true)}else{if(a==iAd.Event.END_EVENT){this._idleStartTime=Date.now();this._autoAdvanceTimer=this.callMethodNameAfterDelay("transitionToNextViewController",this._minimumDelayBeforeTransition);window.removeEventListener(iAd.Event.END_EVENT,this,true)}}}else{if(iAP.ViewController.iTunesEventMap.hasOwnProperty(a)!=-1){var c=[];if(b.track){c.push(["track",b.track])}this.createAndDispatchEvent(iAP.ViewController.iTunesEventMap[a],c)}}this.callSuper(b)};iAP.ViewController.prototype.getNextViewController=function(){return this.nextViewControllerID?iAd.ViewController.instances[this.nextViewControllerID]:null};iAP.ViewController.prototype.setNextViewController=function(a){this.nextViewControllerID=a.id};iAP.ViewController.prototype.preloadNextViewController=function(){if(!this.nextViewController){return}if(this.nextViewController.readyToTransition){this.nextViewControllerIsReadyToTransition(this.nextViewController)}else{this.nextViewController.addPropertyObserver("readyToTransition",this,"nextViewControllerIsReadyToTransition")}this.nextViewController.loadRequiredFiles()};iAP.ViewController.prototype.preloadViewControllers=function(){var d=this.nextViewController;if(d){if(d._autoAdvanceToNextViewControllerOnTimeout){this.callMethodNameAfterDelay("skipNextViewController",d.loadingTimeoutDuration)}this.preloadNextViewController()}if(this.viewControllerIDsToPreload){for(var a=0,c=this.viewControllerIDsToPreload.length;a<c;a++){var b=iAd.ViewController.instances[this.viewControllerIDsToPreload[a]];b.loadRequiredFiles()}}};iAP.ViewController.prototype.skipNextViewController=function(){var a=this.nextViewController;if(a.readyToTransition){return}if(!a._autoAdvanceToNextViewController){return}if(!a.nextViewController){return}a.removePropertyObserver("readyToTransition",this);this.nextViewController=a.nextViewController;this.preloadNextViewController()};iAP.ViewController.prototype.transitionToViewControllerWithID=function(a){this.transitionToViewControllerWithIDAnimated(a,true)};iAP.ViewController.prototype.transitionToViewControllerWithIDAnimated=function(e,b){var c=iAd.ViewController.instances[e];if(c==null){iAd.Console.warn("Attempted to transition to a view controller with an invalid id: "+e);return}var a=iAd.RootViewController.sharedRootViewController.navigationController;var d=(a.viewControllers.indexOf(c)!=-1);if(d){a.popToViewControllerAnimated(c,b)}else{a.pushViewControllerAnimated(c,b)}};iAP.ViewController.prototype.nextViewControllerIsReadyToTransition=function(a){if(!a.readyToTransition){return}a.removePropertyObserver("readyToTransition",this);if(a.configuration.id!=this.nextViewController.id){return}if(this._autoAdvanceToNextViewController){this.transitionToNextViewController()}};iAP.ViewController.prototype.transitionToNextViewController=function(){var d=this.nextViewController;if(!d){return}if(!d.readyToTransition){return}if(this.buildInActionListShouldDelayTransition&&this.isInState(iAd.TransitionController.VIEW_BUILDS_IN_STATE)){return}if(this._autoAdvanceToNextViewController){var c=this._idleStartTime;if(c==null){return}var b=this._minimumDelayBeforeTransition;var a=(Date.now()-c)/1000;if(a<b){this.clearAutoAdvanceTimer();this._autoAdvanceTimer=this.callMethodNameAfterDelay("transitionToNextViewController",b-a);return}}this.transitionToViewControllerWithID(d.configuration.id)};iAP.ViewController.prototype.enterState=function(e){this.callSuper(e);var a,d,c;for(a=0,d=this.topAnchoredSharedViewIDs.length;a<d;a++){c=iAP.SharedView.instances[this.topAnchoredSharedViewIDs[a]];c.layer.addClassName(e)}for(a=0,d=this.bottomAnchoredSharedViewIDs.length;a<d;a++){c=iAP.SharedView.instances[this.bottomAnchoredSharedViewIDs[a]];c.layer.addClassName(e)}if(this.backgroundLayerVisible&&e!="ad-view-builds-in-action-list"&&e!="ad-view-builds-in-action-list-is-active"){var b=iAd.ViewController.instances.Background;b.view.layer.addClassName(e)}};iAP.ViewController.prototype.exitState=function(e){var f=this.callSuper(e);var a,d,c;for(a=0,d=this.topAnchoredSharedViewIDs.length;a<d;a++){c=iAP.SharedView.instances[this.topAnchoredSharedViewIDs[a]];c.layer.removeClassName(e)}for(a=0,d=this.bottomAnchoredSharedViewIDs.length;a<d;a++){c=iAP.SharedView.instances[this.bottomAnchoredSharedViewIDs[a]];c.layer.removeClassName(e)}if(this.backgroundLayerVisible&&e!="ad-view-builds-in-action-list"&&e!="ad-view-builds-in-action-list-is-active"){var b=iAd.ViewController.instances.Background;b.view.layer.removeClassName(e)}if(e==iAd.TransitionController.VIEW_BUILDS_IN_STATE){if(this.buildInActionListShouldDelayTransition){this.transitionToNextViewController()}if(this.minimumDelayBeforeTransition==null&&iAd.Device.iOSVersionLessThan("5.0")){this.cancelActionList(this.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS])}}return f};iAP.ViewController.prototype.viewDidLoad=function(){var b,d;this.view.autoresizesSubviews=false;for(d in this.outlets){b=this.outlets[d];if(iAd.Analytics&&iAd.Analytics._observedObjects[b.id]!=null){b.userInteractionEnabled=true}b.viewController=this;if(b.isViewControllerContainer){this.viewControllerContainers.push(b);b.parentViewControllerViewDidLoad()}}var c=iAP.EventDelegate.viewScriptFunctions[this.configuration.id];for(d in c){b=this.outlets[d];var a=new iAP.EventDelegate(b,b,c[d]);b.userInteractionEnabled=true;a.processUserScript()}this.callSuper()};iAP.ViewController.prototype.viewWillAppear=function(h){var c=this;var b=this.orientation;if(window.iAPDebug!=null){window.iAPDebug.transitioningToViewController(this.configuration.id);if(b!=null){var d=iAd.Transaction.defaults.duration/2;setTimeout(function(){window.iAPDebug.rotateToOrientation(b)},d*1000)}}if(this.backgroundLayerVisible){var f=iAd.ViewController.instances.Background;if(!f.__visible){var a=f.view.layer;this.showBackgroundBuildInActionList=true;f.__visible=true;a.style.display="block"}}this.setOrientation(b);window.addEventListener("orientationchange",this,false);this.callSuper(h);for(var e=0,g=this.viewControllerContainers.length;e<g;e++){this.viewControllerContainers[e].parentViewControllerViewWillAppear(h)}};iAP.ViewController.prototype.viewDidAppear=function(c){var k=this;this.callSuper(c);if(this._autoAdvanceToNextViewController){this._idleStartTime=Date.now();if(this._autoAdvanceCondition=="no-activity"){window.addEventListener(iAd.Event.START_EVENT,this,true)}}if(this._shouldPreloadNextViewControllers&&(this.nextViewController||this.viewControllerIDsToPreload)){this.preloadViewControllers()}iAd.Device.addEventListener(iAd.Device.SHAKE_EVENT,this,false);if(iAP.Context.IS_ITUNES_EXTRA){Object.keys(iAP.ViewController.iTunesEventMap).forEach(function(i){window.addEventListener(i,k)})}this.loadAdditionalFiles();var h=iAd.RootView.sharedRoot;var j=iAd.RootViewController.sharedRootViewController.navigationController.view;var d,f,b;var g=1;for(d=0,f=this.bottomAnchoredSharedViewIDs.length;d<f;d++){b=iAP.SharedView.instances[this.bottomAnchoredSharedViewIDs[d]];h.insertSubviewAtIndex(b,g++)}h.insertSubviewAtIndex(j,g++);for(d=0,f=this.topAnchoredSharedViewIDs.length;d<f;d++){b=iAP.SharedView.instances[this.topAnchoredSharedViewIDs[d]];h.insertSubviewAtIndex(b,g++)}for(d=0,f=this.viewControllerContainers.length;d<f;d++){this.viewControllerContainers[d].parentViewControllerViewDidAppear(c)}var e=iAd.ViewController.instances.Background;if(this.showBackgroundBuildInActionList){iAd.EventTarget.createAndDispatchEvent.call(e,iAd.ViewController.VIEW_DID_APPEAR_EVENT,[["animated",false]]);var a=e.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS];if(a){e.callMethodNameAfterDelay("startActionList",0,a)}this.showBackgroundBuildInActionList=false}if(this.contentView){this.contentView.viewDidAppear()}};iAP.ViewController.prototype.viewWillDisappear=function(d){var m=this;this.callSuper(d);if(this._autoAdvanceToNextViewController){this.clearAutoAdvanceTimer();window.removeEventListener(iAd.Event.START_EVENT,this,true)}iAd.Device.removeEventListener(iAd.Device.SHAKE_EVENT,this,false);if(iAP.Context.IS_ITUNES_EXTRA){Object.keys(iAP.ViewController.iTunesEventMap).forEach(function(i){window.removeEventListener(i,m)})}var k=iAd.RootView.sharedRoot;var c=this.transitionController&&this.transitionController.visibleViewController;var e,g,h,b,j={};for(e=0,g=this.topAnchoredSharedViewIDs.length;e<g;e++){h=this.topAnchoredSharedViewIDs[e];if(!c||c.topAnchoredSharedViewIDs.indexOf(h)==-1&&c.bottomAnchoredSharedViewIDs.indexOf(h)==-1){b=iAP.SharedView.instances[h];this.contentView.addSubview(b);j[h]=true}}for(e=this.bottomAnchoredSharedViewIDs.length-1;e>=0;e--){h=this.bottomAnchoredSharedViewIDs[e];if(!c||c.bottomAnchoredSharedViewIDs.indexOf(h)==-1&&c.topAnchoredSharedViewIDs.indexOf(h)==-1){b=iAP.SharedView.instances[h];this.contentView.insertSubviewAtIndex(b,0);j[h]=true}}if(c){var f=iAd.ViewController.instances.Background;if(f.__visible&&c.backgroundLayerVisible==false){iAd.EventTarget.createAndDispatchEvent.call(f,iAd.ViewController.VIEW_WILL_DISAPPEAR_EVENT,[["animated",false]]);var l=f.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS];if(l){f.callMethodNameAfterDelay("startActionList",0,l)}f.__visible=false;this.hideBackground=true}}for(e=0,g=this.viewControllerContainers.length;e<g;e++){var a=this.viewControllerContainers[e];a.parentViewControllerViewWillDisappear(d,!!j[a.viewControllerId])}};iAP.ViewController.prototype.viewDidDisappear=function(d){this.view.views.forEach(function(e){e.mouseExited()});this.callSuper(d);for(var a=0,c=this.viewControllerContainers.length;a<c;a++){this.viewControllerContainers[a].parentViewControllerViewDidDisappear(d)}if(this.hideBackground){var b=iAd.ViewController.instances.Background;b.view.layer.style.display="";b.resetAllActionLists();this.hideBackground=false}};iAP.ViewController.prototype.loadRequiredFiles=function(){if(window.iAPDebug!=null){var a=this.configuration.requiredFileURIs;var b=a.stylesheets.concat(a.scripts,a.images);b.push(a.contentView);window.iAPDebug.willRequestAssetsForViewController(this.configuration.id,b)}this.callSuper()};iAP.ViewController.prototype.requiredFilesLoaderDidComplete=function(a){this.callSuper(a);if(this.loadedAllRequiredFiles&&this.becomesReadyToTransitionWhenViewsAreLoaded){this.readyToTransition=true}if(window.editorProxy){editorProxy.didInitializeContentView()}};iAP.ViewController.prototype.loadAdditionalFiles=function(){if(this._didLoadAdditionalFiles||!this.configuration.additionalFileURIs||!this.configuration.additionalFileURIs.images){return}var d=this.configuration.additionalFileURIs.images;for(var b=0,c=d.length;b<c;b++){var a=document.createElement("img");a.src=(iAd.Device.HAS_HIDPI_DISPLAY&&this.configuration.hasHiDPIVersion)?iAd.Path.appendHiDPISuffix(d[b]):d[b];document.head.appendChild(a)}this._didLoadAdditionalFiles=true};iAP.ViewController.prototype.setOrientation=function(b){var c=false;if(b==iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT||b==iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT){c=true;this.enterState("ad-landscape")}else{this.exitState("ad-landscape")}if(!iAP.Context.IS_IAD&&navigator.userAgent.match(/iPad/i)){if((c&&window.innerWidth==1024)||(c==false&&window.innerWidth==768)){this.contentView.size=new iAd.Size(window.innerWidth,window.innerHeight)}}if(iAP.Context.IS_SAFARI){iAd.RootView.sharedRoot.setIsLandscape(c)}if(window.ad!=null&&b!=null){if(window.ad.hasOwnProperty("currentSupportedInterfaceOrientations")){var a=ADAd.ADInterfaceOrientationPortrait|ADAd.ADInterfaceOrientationPortraitUpsideDown|ADAd.ADInterfaceOrientationLandscapeLeft|ADAd.ADInterfaceOrientationLandscapeRight;var d=0;switch(b){case iAP.ViewController.ORIENTATION_PORTRAIT:d=ADAd.ADInterfaceOrientationPortrait;case iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN:d=d||ADAd.ADInterfaceOrientationPortraitUpsideDown;if(iAd.Device.IS_IPAD){a=ADAd.ADInterfaceOrientationPortrait|ADAd.ADInterfaceOrientationPortraitUpsideDown}else{a=ADAd.ADInterfaceOrientationPortrait}break;case iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT:d=ADAd.ADInterfaceOrientationLandscapeRight;case iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT:d=d||ADAd.ADInterfaceOrientationLandscapeLeft;a=ADAd.ADInterfaceOrientationLandscapeLeft|ADAd.ADInterfaceOrientationLandscapeRight;if(iAP.ViewController.initialOrientation&&iAP.ViewController.initialOrientation==="-90"){window.ad.currentSupportedInterfaceOrientations=ADAd.ADInterfaceOrientationLandscapeLeft;setTimeout(function(){window.ad.currentSupportedInterfaceOrientations=a},0);if(iAd.RootViewController.sharedRootViewController!=this){delete iAP.ViewController.initialOrientation}return}break}if(window.iAPDebug&&a!=d){window.ad.currentSupportedInterfaceOrientations=d;setTimeout(function(){window.ad.currentSupportedInterfaceOrientations=a},0)}else{window.ad.currentSupportedInterfaceOrientations=a}if(iAd.RootViewController.sharedRootViewController!=this){delete iAP.ViewController.initialOrientation}}}};(function(){var a=localStorage.getItem("iAP:Banner:Orientation");localStorage.removeItem("iAP:Banner:Orientation");if(window.ad&&iAd.Device.iOSVersionLessThan("5.0")){iAP.ViewController.initialOrientation=a}})();iAP.ViewController.instances=iAd.ViewController.instances;