
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAP.SharedView",superclass:iAd.View,cssClassName:"iap-shared-view",synthesizedProperties:["viewControllerId","repositionsSubviews"],archivedProperties:["viewControllerId","repositionsSubviews"],collectionAccessor:"sharedViews"});iAP.SharedView.instances={};iAP.SharedView.prototype.init=function(a){this._repositionsSubviews=true;this.archivedIdsByParentId={};this.previousParentId=null;this.callSuper(a);this.isViewControllerContainer=true};iAP.SharedView.prototype.handleEvent=function(a){this.callSuper(a);if(a.type==iAd.ViewController.VIEW_DID_LOAD&&a.ad.sender==this.containedViewController){this.contentView=this.containedViewController.contentView;if(this.contentView){this.contentView.layer.addClassName("iap-shared-content-view");this.repositionSubviews()}this.containedViewControllerIsLoaded=true}};iAP.SharedView.prototype.parentViewControllerViewDidLoad=function(){this.parentViewControllerIsLoaded=true;this.updateViewController()};iAP.SharedView.prototype.parentViewControllerViewWillAppear=function(b){var c=iAP.SharedView.instances[this.viewControllerId];var a=this.viewController.id;if(c.previousParentId!=a){c.layer.style.webkitAnimation="";c.id=c.archivedIdsByParentId[a];c.previousParentId=a}if(c.superview!=iAd.RootView.sharedRoot){iAd.EventTarget.createAndDispatchEvent.call(this.containedViewController,iAd.ViewController.VIEW_WILL_APPEAR_EVENT,[["animated",b]]);this.shouldDispatchViewDidAppearEvent=true}};iAP.SharedView.prototype.parentViewControllerViewDidAppear=function(b){if(this.shouldDispatchViewDidAppearEvent){var c=this.containedViewController;iAd.EventTarget.createAndDispatchEvent.call(c,iAd.ViewController.VIEW_DID_APPEAR_EVENT,[["animated",b]]);this.shouldDispatchViewDidAppearEvent=false;var a=c.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS];if(a){c.callMethodNameAfterDelay("startActionList",0,a)}}};iAP.SharedView.prototype.parentViewControllerViewWillDisappear=function(b,d){if(!d){return}var e=iAP.SharedView.instances[this.viewControllerId];var c=this.containedViewController;iAP.SharedView.clearWebkitAnimation(e.layer);iAd.EventTarget.createAndDispatchEvent.call(c,iAd.ViewController.VIEW_WILL_DISAPPEAR_EVENT,[["animated",b]]);this.shouldDispatchViewDidDisappearEvent=true;var a=c.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS];if(a){c.callMethodNameAfterDelay("startActionList",0,a)}};iAP.SharedView.clearWebkitAnimation=function(c){c.style.webkitAnimation="";var b=c.children;for(var a=0,d=b.length;a<d;a++){this.clearWebkitAnimation(b[a])}};iAP.SharedView.prototype.parentViewControllerViewDidDisappear=function(b){if(this.shouldDispatchViewDidDisappearEvent){iAd.EventTarget.createAndDispatchEvent.call(this.containedViewController,iAd.ViewController.VIEW_DID_DISAPPEAR_EVENT,[["animated",b]]);this.shouldDispatchViewDidDisappearEvent=false;var a=iAP.SharedView.instances[this.viewControllerId].layer;iAP.SharedView.clearWebkitAnimation(a)}};iAP.SharedView.prototype.setViewControllerId=function(a){if(this._viewControllerId==a){return}this._viewControllerId=a;this.updateViewController()};iAP.SharedView.prototype.repositionSubviews=function(){if(!this._repositionsSubviews){return}var d=this.contentView.subviews;if(d.length>0){var b=new iAd.Point(Infinity,Infinity);for(var a=0,c=d.length;a<c;a++){var e=d[a];b.x=Math.min(b.x,e.position.x);b.y=Math.min(b.y,e.position.y)}this.contentView.position=new iAd.Point(-1*b.x,-1*b.y)}};iAP.SharedView.prototype.updateViewController=function(){if(!this.declarativeLayerWasInitialized||!this.viewControllerId){return}if(this.parentViewControllerIsLoaded){this.processDeferredViewControllerLoad()}else{this.needsDeferredViewControllerUpdate=true}};iAP.SharedView.prototype.processDeferredViewControllerLoad=function(){var e=iAP.SharedView.instances[this.viewControllerId];var a=iAP.ViewController.instances[this.viewControllerId];var d=this.viewController.id;if(!e){e=this;iAP.SharedView.instances[this.viewControllerId]=this;e.archivedIdsByParentId[d]=this.id;a.addEventListener(iAd.ViewController.VIEW_DID_LOAD,this,false);var c=[iAd.ViewController.VIEW_WILL_APPEAR_EVENT,iAd.ViewController.VIEW_DID_APPEAR_EVENT,iAd.ViewController.VIEW_WILL_DISAPPEAR_EVENT,iAd.ViewController.VIEW_DID_DISAPPEAR_EVENT];a.createAndDispatchEvent=function(f,g){if(c.indexOf(f)==-1){iAd.EventTarget.createAndDispatchEvent.call(a,f,g)}};this.addSubview(a.view)}else{if(this.viewController){this.viewController.outlets[this.outlet]=e}e.layer.style.webkitAnimation="";e.archivedIdsByParentId[d]=this.id;e.id=this.id;if(e.superview!=iAd.RootView.sharedRoot){var b=this.superview.subviews.indexOf(this);this.superview.insertSubviewAtIndex(e,b)}this.removeFromSuperview()}e.previousParentId=d;this.containedViewController=a;this.needsDeferredViewControllerUpdate=false};