
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAP.RootViewController",superclass:iAd.RootViewController,mixins:[iAd.EventTarget]});iAP.RootViewController.DID_FINISH_LAUNCHING_EVENT="didFinishLaunching";iAP.RootViewController.WILL_PAUSE_EVENT="adWillPause";iAP.RootViewController.DID_RESUME_EVENT="adDidResume";iAP.RootViewController.WILL_BE_DISMISSED_EVENT="willBeDismissed";iAP.RootViewController.DID_HIDE_EVENT="didHide";iAP.RootViewController.DID_SHOW_EVENT="didShow";iAP.RootViewController.prototype.init=function(c){this.callSuper(c);this.eventTarget=document;if(!iAP.Context.IS_IAD&&this.targetDevice){if(this.targetDevice==="iPad"){iAd.Device.IS_IPAD=true;document.body.addClassName("ad-iPad")}}this.navigationController.view.clipsToBounds=false;var b=this;var a=iAd.ViewController.viewControllerWithConfiguration;iAd.ViewController.viewControllerWithConfiguration=function(g){var e=a.apply(this,arguments);var d=iAd.ViewController.instances[g.id];var f=d.configuration.id;if(f==b.initialViewControllerID){if(f=="Background"){d.__visible=true;d.view.layer.style.display="block"}else{if(window.editorProxy||b.navigationController==null){b.transitionController.setVisibleViewControllerAnimated(d,true)}else{b.navigationController.pushViewControllerAnimated(d,true);b.navigationController.autoReversesTransitions=true}}}return e};if(window.ad){window.ad.listener=this;this.registerItemsForPurchase(this.iTunesStoreIds)}if(c.videoWifiToCellularMapping){iAd.VideoWifiToCellularMapping=c.videoWifiToCellularMapping}};iAP.RootViewController.prototype.loadView=function(){if(!iAP.Context.IS_IAD_PRODUCER){iAd.RootView.sharedRoot=new iAd.RootView("#root")}this.callSuper()};iAP.RootViewController.prototype.viewDidLoad=function(){this.callSuper();this.view.autoresizesSubviews=true};iAP.RootViewController.prototype.registerItemsForPurchase=function(c){var a,b;if(c&&typeof(c.map)==="function"&&c.length>0){this.iTunesStoreIds=a=c}else{this.purchaseItemsWereRegistered=false;return false}b=a.map(function(d){return parseInt(d,10)});iAd.Store.registerItemsForPurchase(b);this.purchaseItemsWereRegistered=true;return true};iAP.RootViewController.prototype.getNavigationController=function(){var a=this.callSuper();a.backingTransitionController.hidesLoadingViewControllerWithTransition=false;return a};iAP.RootViewController.createRootViewController=function(a){window.addEventListener("DOMContentLoaded",function(){var b=new iAP.RootViewController(a);b.setupEventDelegate();b.createAndDispatchEvent(iAP.RootViewController.DID_FINISH_LAUNCHING_EVENT)});window.addEventListener("bookletopened",function(){iAP.RootViewController.resumeBackgroundAudio("bookletopened")});window.addEventListener("ended",function(){iAP.RootViewController.resumeBackgroundAudio("ended")});window.addEventListener("bookletclosing",function(){iAd.RootViewController.sharedRootViewController.createAndDispatchEvent(iAP.RootViewController.WILL_BE_DISMISSED_EVENT)});window.addEventListener("hidden",function(){iAd.RootViewController.sharedRootViewController.createAndDispatchEvent(iAP.RootViewController.DID_HIDE_EVENT)});window.addEventListener("shown",function(){iAP.RootViewController.resumeBackgroundAudio("shown");iAd.RootViewController.sharedRootViewController.createAndDispatchEvent(iAP.RootViewController.DID_SHOW_EVENT)});iAP.RootViewController.configureViewport()};iAP.RootViewController.prototype.setupEventDelegate=function(){var b=iAP.EventDelegate.viewControllerScriptFunctions[this.configuration.id];if(b){var a=new iAP.EventDelegate(this,this,b);a.processUserScript()}};iAP.RootViewController.prototype.adWillBeDismissed=function(){this.createAndDispatchEvent(iAP.RootViewController.WILL_BE_DISMISSED_EVENT)};iAP.RootViewController.configureViewport=function(){var a=document.createElement("meta");a.setAttribute("name","viewport");a.setAttribute("content","width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no");document.head.appendChild(a);if(!iAP.Context.IS_IAD&&iAP.Context.IS_IOS){var b=document.createElement("meta");b.setAttribute("name","apple-mobile-web-app-capable");b.setAttribute("content","yes");document.head.appendChild(b)}};iAP.RootViewController.resumeBackgroundAudio=function(a){var b=true;if(a!="shown"&&window.iTunes.currentPlayingTrack!=null){b=false}if(b){iAP.RootViewController.playBackgroundAudio()}};iAP.RootViewController.playBackgroundAudio=function(){var b=iAd.RootViewController.sharedRootViewController.backgroundAudioSrc;var a=!!iAd.RootViewController.sharedRootViewController.backgroundAudioShouldLoop;var d=!!iAd.RootViewController.sharedRootViewController.backgroundAudioHasPlayed;if(b){if(!iAP.RootViewController.audioLoop){var c=new Audio();c.src=b;c.loop=a;c.style.display="none";c.addEventListener("ended",function(){iAd.RootViewController.sharedRootViewController.backgroundAudioHasPlayed=true});document.body.appendChild(c);iAP.RootViewController.audioLoop=c}if(a||d==false){iAP.RootViewController.audioLoop.play()}}};