
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.VideoPlayer",superclass:iAd.MediaPlayer,synthesizedProperties:["video","showsControls","playsInline","posterImage","posterImageVisible"],cssClassName:"ad-video-player",collectionAccessor:"videoPlayers"});iAd.VideoPlayer.POSTER_VISIBLE_STATE="ad-poster-image-visible";iAd.VideoPlayer.DID_CHANGE_FULLSCREEN="videoDidChangeFullscreen";iAd.VideoPlayer.prototype.init=function(a){this._playsInline=true;this._showsControls=false;this._posterImageVisible=true;this.callSuper(a)};iAd.VideoPlayer.prototype.getMediaAttributeName=function(){return"ad-video"};iAd.VideoPlayer.prototype.getMediaClassType=function(){return iAd.Video};iAd.VideoPlayer.prototype.isFullscreen=function(){return this.media.isFullscreen()};iAd.VideoPlayer.prototype.layerWasCreated=function(){var a=this.posterView=new iAd.View();a.layer.addClassName("ad-poster-image");this.addSubview(a);this.layer.addClassName(iAd.VideoPlayer.POSTER_VISIBLE_STATE)};iAd.VideoPlayer.prototype.setValueForAttribute=function(b,a){if(a=="ad-poster-image"){this.posterImage=iAd.Image.imageForURL(b,this.layerHasCustomAttribute("ad-has-hidpi-version"));return}this.callSuper(b,a)};iAd.VideoPlayer.prototype.setVideo=function(a){this.posterImageVisible=true;this.media=a};iAd.VideoPlayer.prototype.getVideo=function(){return this.media};iAd.VideoPlayer.prototype.setPosterImage=function(a){if(iAd.Utils.objectIsString(a)){a=iAd.Image.imageForURL(a)}if(this._posterImage==a){return}if(this._posterImage){this._posterImage.removePropertyObserver("loaded",this,"posterImageLoaded")}this._posterImage=a;this.syncPosterImage()};iAd.VideoPlayer.prototype.setShowsControls=function(a){this._showsControls=a;this.syncMediaProperties()};iAd.VideoPlayer.prototype.setPlaysInline=function(a){this._playsInline=a;this.syncMediaProperties()};iAd.VideoPlayer.prototype.setSize=function(a){this.callSuper(a);this.syncMediaProperties()};iAd.VideoPlayer.prototype.syncMediaProperties=function(){if(!this._media){return}this._media.showsControls=this._showsControls;this._media.playsInline=this._playsInline;this._playsInline=this._media.playsInline;this.callSuper()};iAd.VideoPlayer.prototype.registerMedia=function(b){var a=(b.playbackState==iAd.Media.PLAYBACK_STATE_PLAYING);if(!this.callSuper(b)){return}this.insertSubviewAtIndex(b.view,0);if(a){this.callMethodNameAfterDelay("play",0)}};iAd.VideoPlayer.prototype.unregisterMedia=function(a){if(!this.callSuper(a)){return}this.posterImageVisible=true;if(a.view.superview==this){a.view.removeFromSuperview()}};iAd.VideoPlayer.prototype.syncPosterImage=function(){var b=this.posterView.layer;if(this._posterImage==null){b.style.removeProperty("background-image");return}if(this._posterImage){var a=this._posterImage;if(a.loaded){b.style.backgroundImage="url("+a.resolvedURL+")"}else{a.addPropertyObserver("loaded",this,"posterImageLoaded")}}};iAd.VideoPlayer.prototype.posterImageLoaded=function(a,b){a.removePropertyObserver("loaded",this,"posterImageLoaded");this.syncPosterImage()};iAd.VideoPlayer.prototype.setPosterImageVisible=function(a){if(this._posterImageVisible==a){return}this._posterImageVisible=a;this.layer.toggleClassName(iAd.VideoPlayer.POSTER_VISIBLE_STATE,a)};iAd.VideoPlayer.prototype.mediaPlaybackDidStart=function(a){this.posterImageVisible=false;this.callSuper(a)};iAd.VideoPlayer.prototype.mediaPlaybackDidEnd=function(a){this.callSuper(a);a.exitFullscreen()};iAd.VideoPlayer.prototype.mediaDidUnload=function(a){this.posterImageVisible=true;this.callSuper(a)};iAd.VideoPlayer.prototype.videoDidChangeFullscreen=function(b,a){this.dispatchNotification(iAd.VideoPlayer.DID_CHANGE_FULLSCREEN,this.delegate,[["fullscreen",a]])};