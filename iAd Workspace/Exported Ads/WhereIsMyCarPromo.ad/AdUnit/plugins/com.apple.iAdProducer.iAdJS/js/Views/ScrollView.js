
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.ScrollView",superclass:iAd.View,synthesizedProperties:["contentOffset","contentSize","indicatorStyle","scrollEnabled","scrollIndicatorInsets","dragging","pagingEnabled","pageSize","bounces","showsHorizontalScrollIndicator","showsVerticalScrollIndicator","usesNativeScrolling"],archivedProperties:["contentSize","contentOffset","indicatorStyle","scrollEnabled","scrollIndicatorInsets","showsHorizontalScrollIndicator","showsVerticalScrollIndicator","pagingEnabled","pageSize","bounces","alwaysBounceHorizontal","alwaysBounceVertical","delaysContentTouches","canCancelContentTouches"],cssClassName:"ad-scroll-view",collectionAccessor:"scrollViews"});iAd.ScrollView.WILL_BEGIN_DRAGGING="scrollViewWillBeginDragging";iAd.ScrollView.WILL_BEGIN_SCROLLING_ANIMATION="scrollViewWillBeginScrollingAnimation";iAd.ScrollView.DID_END_SCROLLING_ANIMATION="scrollViewDidEndScrollingAnimation";iAd.ScrollView.DID_SCROLL="scrollViewDidScroll";iAd.ScrollView.WILL_END_DRAGGING="scrollViewWillEndDraggingWithVelocityAndTargetContentOffset";iAd.ScrollView.DID_END_DRAGGING="scrollViewDidEndDragging";iAd.ScrollView.WILL_BEGIN_DECELERATING="scrollViewWillBeginDecelerating";iAd.ScrollView.DID_END_DECELERATING="scrollViewDidEndDecelerating";iAd.ScrollView.MIN_INDICATOR_LENGTH=34;iAd.ScrollView.DECELERATION_FRICTION_FACTOR=0.998;iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE=1/60;iAd.ScrollView.MINIMUM_VELOCITY=10;iAd.ScrollView.PENETRATION_DECELERATION=5;iAd.ScrollView.PENETRATION_ACCELERATION=8;iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION=250;iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION_WITH_PAGING=300;iAd.ScrollView.PAGING_ACCELERATION=0.00036;iAd.ScrollView.PAGING_DECELERATION=0.9668;iAd.ScrollView.PAGING_TRANSITION_DURATION=0.25;iAd.ScrollView.CONTENT_TOUCHES_DELAY=0.15;iAd.ScrollView.AUTOMATED_CONTENT_SIZE=-1;iAd.ScrollView.INDICATOR_STYLE_DEFAULT="ad-indicator-default";iAd.ScrollView.INDICATOR_STYLE_BLACK="ad-indicator-black";iAd.ScrollView.INDICATOR_STYLE_WHITE="ad-indicator-white";iAd.ScrollView.NON_NATIVE_PROPERTIES={pagingEnabled:true,bounces:false,showsHorizontalScrollIndicator:false,showsVerticalScrollIndicator:false};iAd.ScrollView.TEXT_FIELD_INPUT_TYPES=["text","password","email","url","search","tel","number","week"];iAd.ScrollView.prototype.init=function(b){this._contentOffset=new iAd.Point();this._contentSize=iAd.ScrollView.AUTOMATED_CONTENT_SIZE;this.adjustedContentSize=new iAd.Size();this._dragging=false;this.decelerating=false;this.decelerationTimer=null;this._indicatorStyle="";this._showsHorizontalScrollIndicator=true;this._showsVerticalScrollIndicator=true;this._scrollIndicatorInsets=new iAd.EdgeInsets(0,0,0,0);this.scrollIndicatorsNeedFlashing=false;this._pagingEnabled=false;this._pageSize=new iAd.Size();this._bounces=true;this.alwaysBounceHorizontal=false;this.alwaysBounceVertical=false;this.delegate=null;this.delaysContentTouches=true;this.canCancelContentTouches=true;this._setContentOffsetAnimatedCalledFromSetter=false;this.beginTouchesInContentTimer=null;this.panGestureRecognizer=new iAd.ScrollViewPanGestureRecognizer();this.panGestureRecognizer.delegate=this;this.callSuper(b);this.userInteractionEnabled=true;this.layer.addEventListener("webkitTransitionEnd",this,false);this.hostingLayer.addEventListener("webkitTransitionEnd",this,false);this.addGestureRecognizer(this.panGestureRecognizer);this.layer.addEventListener("focus",this,true);this.shouldPreventSelectElementFocus=false;for(var a in iAd.ScrollView.NON_NATIVE_PROPERTIES){this.addPropertyObserver(a,this,"handleNonNativePropertyChange")}};iAd.ScrollView.prototype.createLayer=function(){this.callSuper();this._hostingLayer=this.layer.appendChild(document.createElement("div"));this._hostingLayer.className="ad-hosting-layer";this.clipsToBounds=true;this.createScrollIndicators();this.indicatorStyle=iAd.ScrollView.INDICATOR_STYLE_DEFAULT};iAd.ScrollView.prototype.setupLayer=function(){this.callSuper();this._hostingLayer=document.createElement("div");this._hostingLayer.className="ad-hosting-layer";while(this.layer.firstChild){this._hostingLayer.appendChild(this.layer.firstChild)}this.layer.appendChild(this._hostingLayer);this.updateAlwaysBounce();if(!this.usesNativeScrolling){this.createScrollIndicators()}this.indicatorStyle=this.layerHasCustomAttribute("ad-indicator-style")?this.getLayerCustomAttributeValue("ad-indicator-style"):iAd.ScrollView.INDICATOR_STYLE_DEFAULT};iAd.ScrollView.prototype.setValueForAttribute=function(b,a){switch(a){case"ad-scroll-indicator-inset-left":this._scrollIndicatorInsets.left=parseInt(b);break;case"ad-scroll-indicator-inset-top":this._scrollIndicatorInsets.top=parseInt(b);break;case"ad-scroll-indicator-inset-right":this._scrollIndicatorInsets.right=parseInt(b);break;case"ad-scroll-indicator-inset-bottom":this._scrollIndicatorInsets.bottom=parseInt(b);break;case"ad-indicator-style":this.indicatorStyle=(b=="")?iAd.ScrollView.INDICATOR_STYLE_DEFAULT:b;break;case"ad-uses-native-scrolling":this.usesNativeScrolling=(b=="true")?true:false;break;case"ad-page-width":this.pageSize=new iAd.Size(parseFloat(b),this.pageSize.height);break;case"ad-page-height":this.pageSize=new iAd.Size(this.pageSize.width,parseFloat(b));break;default:this.callSuper(b,a)}};iAd.ScrollView.prototype.setBounces=function(a){if(this._bounces==a){return}this._bounces=a;this.updateAlwaysBounce()};iAd.ScrollView.prototype.setAlwaysBounceVertical=function(a){if(this._alwaysBounceVertical==a){return}this._alwaysBounceVertical=a;this.updateAlwaysBounce()};iAd.ScrollView.prototype.setAlwaysBounceHorizontal=function(a){if(this._alwaysBounceHorizontal==a){return}this._alwaysBounceHorizontal=a;this.updateAlwaysBounce()};iAd.ScrollView.prototype.updateAlwaysBounce=function(){if(!this.usesNativeScrolling){if(this._hostingLayer.style.width==(this._size.width+1)+"px"){this._hostingLayer.style.width=this._size.width+"px"}if(this._hostingLayer.style.height==(this._size.height+1)+"px"){this._hostingLayer.style.height=this._size.height+"px"}return}if(this.bounces&&this._alwaysBounceHorizontal&&(!this._contentSize.width||this._contentSize.width<this._size.width)){this._hostingLayer.style.width=(this._size.width+1)+"px"}else{this._hostingLayer.style.width=""}if(this.bounces&&this._alwaysBounceVertical&&(!this._contentSize.height||this._contentSize.height<this._size.height)){this._hostingLayer.style.height=(this._size.height+1)+"px"}else{this._hostingLayer.style.height=""}};iAd.ScrollView.prototype.setSize=function(a){if(this._size.equals(a)){return}this.callSuper(a);if(this._contentSize!==iAd.ScrollView.AUTOMATED_CONTENT_SIZE||this.layerIsInDocument){this.adjustContentSize(true)}};iAd.ScrollView.prototype.getPageSize=function(){return this._pageSize.equals(iAd.Size.ZERO_SIZE)?this._size:this._pageSize};iAd.ScrollView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();if(this._contentSize===iAd.ScrollView.AUTOMATED_CONTENT_SIZE){this.adjustContentSize(true)}};iAd.ScrollView.prototype.setUserInteractionEnabled=function(a){if(this._userInteractionEnabled==a){return}this.callSuper(a);this.layer[a?"addEventListener":"removeEventListener"](iAd.Event.START_EVENT,this,true)};iAd.ScrollView.prototype.setUsesNativeScrolling=function(c){if(this._usesNativeScrolling==c){return}if(c&&iAd.Device.iOS_VERSION&&iAd.Device.iOSVersionLessThan("5.0")){iAd.Console.warn("iAd.ScrollView.usesNativeScrolling is only available on iOS 5 and later.");return}this._usesNativeScrolling=c;if(c){var b=iAd.ScrollView.NON_NATIVE_PROPERTIES;for(var a in b){if(this[a]==b[a]){this[a]=!b[a];iAd.Console.warn('iAd.ScrollView - the value for "'+a+'" was reverted to '+!b[a]+" to support native scrolling.")}}}this.layer.style.overflow=(c&&!this._scrollEnabled)?"scroll":"";this.layer.style.webkitOverflowScrolling=c?"touch":"none";this.layer.style.webkitTransition=c?"none":"-webkit-transform";this.layer[this._usesNativeScrolling?"addEventListener":"removeEventListener"]("scroll",this,false);if(!this._usesNativeScrolling){if(!this.horizontalScrollIndicator){this.createScrollIndicators()}this.handleScrollEvent()}else{this.hideScrollIndicators()}this.updateScrollPositionWithContentOffset();this.updateAlwaysBounce()};iAd.ScrollView.prototype.handleNonNativePropertyChange=function(c,b){var a=iAd.ScrollView.NON_NATIVE_PROPERTIES;if(this.usesNativeScrolling&&this[b]==a[b]){iAd.Console.warn('iAd.ScrollView - native scrolling was disabled because an unsupported value was set for "'+b+'"');this.usesNativeScrolling=false}};iAd.ScrollView.prototype.getScrollEnabled=function(){return this.panGestureRecognizer.enabled};iAd.ScrollView.prototype.setScrollEnabled=function(a){if(this.usesNativeScrolling){this.layer.style.overflowX=this.layer.style.overflowY=a?"scroll":"hidden"}this.panGestureRecognizer.enabled=a};iAd.ScrollView.prototype.setContentOffset=function(a){this._setContentOffsetAnimatedCalledFromSetter=true;this.setContentOffsetAnimated(a,false)};iAd.ScrollView.prototype.setContentOffsetAnimated=function(c,a,b){if(!c||c.equals(this._contentOffset)){return}if(a){if(!this.usesNativeScrolling){this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_SCROLLING_ANIMATION,this.delegate)}else{iAd.Console.warn("iAd.ScrollView - animated content offsets are not supported with native scrolling.")}}this._contentOffset=new iAd.Point(iAd.CSS.roundedPxValue(c.x),iAd.CSS.roundedPxValue(c.y));if(!this.dragging&&!this.decelerating){this.adjustContentSize(false);this._contentOffset.x=iAd.Number.clampValue(this._contentOffset.x,0,this.maxPoint.x);this._contentOffset.y=iAd.Number.clampValue(this._contentOffset.y,0,this.maxPoint.y)}this.updateScrollPositionWithContentOffset();if(a&&!this.usesNativeScrolling){this.scrollTransitionsNeedRemoval=true;this.hostingLayer.style.webkitTransitionDuration=(b||iAd.ScrollView.PAGING_TRANSITION_DURATION)+"s"}else{this.didScroll(false)}if(!a&&!this.usesNativeScrolling){if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator){this.updateHorizontalScrollIndicator()}if(this.canScrollVertically&&this.showsVerticalScrollIndicator){this.updateVerticalScrollIndicator()}}if(!this._setContentOffsetAnimatedCalledFromSetter){this.notifyPropertyChange("contentOffset")}this._setContentOffsetAnimatedCalledFromSetter=false};iAd.ScrollView.prototype.updateScrollPositionWithContentOffset=function(){if(this.usesNativeScrolling){this.hostingLayer.style.webkitTransform=iAd.CSS.t(0,0);this.layer.scrollTop=this._contentOffset.y;this.layer.scrollLeft=this._contentOffset.x}else{this.layer.scrollTop=this.layer.scrollLeft=0;this.hostingLayer.style.webkitTransform=iAd.CSS.tm(-this._contentOffset.x,-this._contentOffset.y)}};iAd.ScrollView.prototype.snapContentOffsetToBounds=function(b){var d=false;var c=new iAd.Point();if(this.pagingEnabled&&b){var a=this.pageSize;c.x=Math.round(this._contentOffset.x/a.width)*a.width;c.y=Math.round(this._contentOffset.y/a.height)*a.height;d=true}else{if(this.bounces){c.x=iAd.Number.clampValue(this._contentOffset.x,0,this.maxPoint.x);c.y=iAd.Number.clampValue(this._contentOffset.y,0,this.maxPoint.y);d=(c.x!=this._contentOffset.x||c.y!=this._contentOffset.y)}}if(d){this.setContentOffsetAnimated(c,b)}};iAd.ScrollView.prototype.getContentSize=function(){var b=this._contentSize;if(b===iAd.ScrollView.AUTOMATED_CONTENT_SIZE){b=new iAd.Size(this._hostingLayer.offsetWidth,this._hostingLayer.offsetHeight);for(var a=0,c=this.subviews.length;a<c;a++){var d=this.subviews[a];b.width=Math.max(b.width,d.position.x+d.size.width);b.height=Math.max(b.height,d.position.y+d.size.height)}}return b};iAd.ScrollView.prototype.setClipsToBounds=function(a){if(!this.usesNativeScrolling){this.callSuper(a)}};iAd.ScrollView.prototype.setContentSize=function(a){if(!a){return}this._contentSize=a;this.adjustContentSize(false);this.updateAlwaysBounce()};iAd.ScrollView.prototype.adjustContentSize=function(a){if(a){var b=new iAd.Point();if(this.adjustedContentSize.width!=0){b.x=this._contentOffset.x/this.adjustedContentSize.width}if(this.adjustedContentSize.height!=0){b.y=this._contentOffset.y/this.adjustedContentSize.height}}this.adjustedContentSize.width=Math.max(this._size.width,this.contentSize.width);this.adjustedContentSize.height=Math.max(this._size.height,this.contentSize.height);this.maxPoint=new iAd.Point(this.adjustedContentSize.width-this._size.width,this.adjustedContentSize.height-this._size.height);if(a){this.contentOffset=new iAd.Point(Math.min(b.x*this.adjustedContentSize.width,this.maxPoint.x),Math.min(b.y*this.adjustedContentSize.height,this.maxPoint.y))}this.canScrollHorizontally=(this.size.width<this.adjustedContentSize.width);this.canScrollVertically=(this.size.height<this.adjustedContentSize.height)};iAd.ScrollView.prototype.setIndicatorStyle=function(a){this._indicatorStyle=a;if(this.usesNativeScrolling){iAd.Console.warn("iAd.ScrollView - indicatorStyle property is not supported with native scrolling.");return}this.horizontalScrollIndicator.indicatorStyle=a;this.verticalScrollIndicator.indicatorStyle=a};iAd.ScrollView.prototype.setScrollIndicatorInsets=function(a){this._scrollIndicatorInsets=a;if(this.usesNativeScrolling){iAd.Console.warn("iAd.ScrollView - scrollIndicatorInsets property is not supported with native scrolling.");return}if(this.horizontalScrollIndicator.visible){this.updateHorizontalScrollIndicator()}if(this.verticalScrollIndicator.visible){this.updateVerticalScrollIndicator()}};iAd.ScrollView.prototype.createScrollIndicators=function(){this.horizontalScrollIndicator=new iAd.ScrollIndicator(iAd.ScrollIndicator.TYPE_HORIZONTAL);this.layer.appendChild(this.horizontalScrollIndicator.layer);this.horizontalScrollIndicator.indicatorStyle=this._indicatorStyle;this.verticalScrollIndicator=new iAd.ScrollIndicator(iAd.ScrollIndicator.TYPE_VERTICAL);this.layer.appendChild(this.verticalScrollIndicator.layer);this.verticalScrollIndicator.indicatorStyle=this._indicatorStyle};iAd.ScrollView.prototype.updateHorizontalScrollIndicator=function(){var h=this.scrollIndicatorInsets.left+1;var c=this.size.width-this.scrollIndicatorInsets.right-1;if(this.canScrollVertically&&this.showsVerticalScrollIndicator){c-=iAd.ScrollIndicator.THICKNESS-1}var g=iAd.ScrollView.MIN_INDICATOR_LENGTH;var e=c-h;var d=Math.max(g,Math.round((this.size.width/this.adjustedContentSize.width)*e));var f=this.size.height-iAd.ScrollIndicator.THICKNESS-this.scrollIndicatorInsets.bottom-1;var a;if(this.contentOffset.x<0){d=Math.round(Math.max(d+this.contentOffset.x,iAd.ScrollIndicator.THICKNESS));a=h}else{if(this.contentOffset.x>this.maxPoint.x){d=Math.round(Math.max(d+this.adjustedContentSize.width-this.size.width-this.contentOffset.x,iAd.ScrollIndicator.THICKNESS));a=c-d}else{var b=(this.contentOffset.x/(this.adjustedContentSize.width-this.size.width));a=iAd.Number.clampValue(Math.round(b*(e-d)+this.scrollIndicatorInsets.left),h,c-d)}}this.horizontalScrollIndicator.position=new iAd.Point(a,f);this.horizontalScrollIndicator.width=d};iAd.ScrollView.prototype.updateVerticalScrollIndicator=function(){var h=this.scrollIndicatorInsets.top+1;var f=this.size.height-this.scrollIndicatorInsets.bottom-1;if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator){f-=iAd.ScrollIndicator.THICKNESS-1}var d=iAd.ScrollView.MIN_INDICATOR_LENGTH;var e=f-h;var b=Math.max(d,Math.round((this.size.height/this.adjustedContentSize.height)*e));var a=this.size.width-iAd.ScrollIndicator.THICKNESS-this.scrollIndicatorInsets.right-1;var g;if(this.contentOffset.y<0){b=Math.round(Math.max(b+this.contentOffset.y,iAd.ScrollIndicator.THICKNESS));g=h}else{if(this.contentOffset.y>this.maxPoint.y){b=Math.round(Math.max(b+this.adjustedContentSize.height-this.size.height-this.contentOffset.y,iAd.ScrollIndicator.THICKNESS));g=f-b}else{var c=(this.contentOffset.y/(this.adjustedContentSize.height-this.size.height));g=iAd.Number.clampValue(Math.round(c*(e-b)+this.scrollIndicatorInsets.top),h,f-b)}}this.verticalScrollIndicator.position=new iAd.Point(a,g);this.verticalScrollIndicator.height=b};iAd.ScrollView.prototype.flashScrollIndicators=function(a){if(this.usesNativeScrolling){return}if(a){this.scrollIndicatorsNeedFlashing=true;return}if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator&&(this.adjustedContentSize.width>this._size.width)){this.updateHorizontalScrollIndicator();this.horizontalScrollIndicator.flash()}if(this.canScrollVertically&&this.showsVerticalScrollIndicator&&(this.adjustedContentSize.height>this._size.height)){this.updateVerticalScrollIndicator();this.verticalScrollIndicator.flash()}};iAd.ScrollView.prototype.hideScrollIndicators=function(){this.horizontalScrollIndicator.visible=false;this.verticalScrollIndicator.visible=false};iAd.ScrollView.prototype.showHorizontalScrollIndicator=function(){if(this.usesNativeScrolling){return}this.horizontalScrollIndicator.visible=true};iAd.ScrollView.prototype.showVerticalScrollIndicator=function(){if(this.usesNativeScrolling){return}this.verticalScrollIndicator.visible=true};iAd.ScrollView.prototype.handleEvent=function(a){if(a.hasOwnProperty("_synthetic")){return}if(a.type=="focus"&&this.shouldPreventSelectElementFocus){a.stopPropagation();a.preventDefault();this.originalTarget.blur();return}if(a.type==iAd.Event.START_EVENT&&a.eventPhase==Event.CAPTURING_PHASE){this.touchesBeganInCapturePhase(a)}else{if(a.type=="webkitTransitionEnd"){this.transitionEnded(a)}else{if(a.type=="scroll"){this.handleScrollEvent(a)}else{this.callSuper(a)}}}};iAd.ScrollView.prototype.handleScrollEvent=function(a){this._contentOffset=new iAd.Point(this.layer.scrollLeft,this.layer.scrollTop);this.notifyPropertyChange("contentOffset");this.didScroll(!!a)};iAd.ScrollView.prototype.touchesBeganInCapturePhase=function(b){if(!this.scrollEnabled){return}var a=iAd.View.nearestViewForElement(b.target);while(a&&a!=this){if(a instanceof iAd.ScrollView&&a.scrollEnabled&&a.userInteractionEnabled){return}a=iAd.ScrollViewPanGestureRecognizer.parentScrollViewForView(a)}b.stopPropagation()};iAd.ScrollView.prototype.touchesBegan=function(a){if(document.activeElement===a.target){this.interruptTrackingInteraction(true)}else{this.beginTracking(a)}};iAd.ScrollView.prototype.touchesMoved=function(b){var a=this.getInitialTouch(b);if(a==null){return}this.lastKnownTouchPosition=iAd.Point.fromEvent(a);if(this.contentTouchesCouldNotBeCancelled){return}this.callSuper(b)};iAd.ScrollView.prototype.shouldPreventEventDefault=function(a){if(a.type==iAd.Event.MOVE_EVENT||a.type==iAd.Event.START_EVENT){return(!this.usesNativeScrolling&&!iAd.ScrollView.isViewInNativeScrollView(this)&&!iAd.ScrollView.viewHasTrackingNativeChildScrollView(this)&&!iAd.ScrollView.hostScrollView.scrollEnabled)}return true};iAd.ScrollView.prototype.touchesEnded=function(a){if(this.getInitialTouch(a)==null){return}this.stopTrackingTouches();if(!this.scrollEnabled){return}this.originalEndEvent=a;if(this.contentTouchesCouldNotBeCancelled){if(this.isOriginalTargetElementAtPoint(this.lastKnownTouchPosition)){if(!a.hasOwnProperty("_scrollViewDispatchedEventToContent")){this.dispatchClickToContent();a._scrollViewDispatchedEventToContent=true}}else{if(this.originalTarget.localName=="select"){this.shouldPreventSelectElementFocus=true}}return}if(this.dragging){a.preventDefault();if(this.originalTarget.localName=="select"){this.shouldPreventSelectElementFocus=true}a.stopPropagation()}else{this.hideScrollIndicators();if(this.isOriginalTargetElementAtPoint(this.lastKnownTouchPosition)){if(!a.hasOwnProperty("_scrollViewDispatchedEventToContent")){a.stopPropagation();if(this.touchesInContentBegan){this.endTouchesInContent()}else{this.dispatchTapSequenceToContent()}this.dispatchClickToContent();a._scrollViewDispatchedEventToContent=true}}else{if(this.originalTarget.localName=="select"){this.shouldPreventSelectElementFocus=true}else{a.preventDefault()}}}};iAd.ScrollView.prototype.touchesCancelled=function(a){this.stopTrackingTouches();this.hideScrollIndicators()};iAd.ScrollView.prototype.panningGestureDidFail=function(a,b,c){this.stopTrackingTouches();if(!c||!c.view.usesNativeScrolling){b.preventDefault()}};iAd.ScrollView.prototype.panningGestureDidStart=function(a,b){if(this.contentTouchesCouldNotBeCancelled){return}if(this.canCancelContentTouches&&this.touchesInContentBegan&&!this.touchesShouldCancelInContentElementAndView(this.originalTarget,iAd.View.nearestViewForElement(this.originalTarget))){this.interruptTrackingInteraction(true);return}this.cancelTouchesInContent();this.hostingLayer.style.webkitTransitionDuration=0;this.startContentOffset=this.contentOffset.copy();this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_DRAGGING,this.delegate);this.dragging=true;if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator&&(this.adjustedContentSize.width>this._size.width)){this.showHorizontalScrollIndicator()}if(this.canScrollVertically&&this.showsVerticalScrollIndicator&&(this.adjustedContentSize.height>this._size.height)){this.showVerticalScrollIndicator()}};iAd.ScrollView.prototype.panningGestureDidChange=function(c,g){if(this.contentTouchesCouldNotBeCancelled){return}g.stopPropagation();if(this.usesNativeScrolling){return}var b=(this.canScrollHorizontally||(this.bounces&&this.alwaysBounceHorizontal));var a=(this.canScrollVertically||(this.bounces&&this.alwaysBounceVertical));var e=c.translationInView();var f=b?(this.startContentOffset.x-e.x):this._contentOffset.x;var d=a?(this.startContentOffset.y-e.y):this._contentOffset.y;if(this.bounces){f-=((f>this.maxPoint.x)?(f-this.maxPoint.x):((f<0)?f:0))/2;d-=((d>this.maxPoint.y)?(d-this.maxPoint.y):((d<0)?d:0))/2}else{f=iAd.Number.clampValue(f,0,this.maxPoint.x);d=iAd.Number.clampValue(d,0,this.maxPoint.y)}this.contentOffset=new iAd.Point(f,d)};iAd.ScrollView.prototype.panningGestureDidEnd=function(a,b){if(this.contentTouchesCouldNotBeCancelled){return}this.dragging=false;this.stopTrackingTouches();if(!this.usesNativeScrolling){this.startDecelerationAnimation()}this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);if(!this.decelerating&&!this.usesNativeScrolling){this.snapContentOffsetToBounds(true);this.hideScrollIndicators()}};iAd.ScrollView.prototype.panningGestureDidCancel=function(a,b){if(!this._dragging){return}this.dragging=false;if(!this.usesNativeScrolling){this.snapContentOffsetToBounds(true)}this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);this.hideScrollIndicators()};iAd.ScrollView.prototype.getInitialTouch=function(c){if(!iAd.Event.SUPPORTS_TOUCHES){return c}var d;for(var a=0,b=c.changedTouches.length;a<b;a++){d=c.changedTouches[a];if(d.identifier==this.initialTouchIdentifier){return d}}return null};iAd.ScrollView.prototype.beginTracking=function(b){if(this._tracking){return}this.stopDecelerationAnimation();if(!this.usesNativeScrolling){this.snapContentOffsetToBounds(false)}this.lastKnownTouchPosition=iAd.Point.fromEvent(b);var a=iAd.Event.SUPPORTS_TOUCHES?b.targetTouches[0]:b;this.initialTouchIdentifier=a.identifier;var c=a.target;this.originalTarget=(c.nodeType===Node.ELEMENT_NODE)?c:c.parentElement;this.originalStartEvent=b;if(this.originalTarget.localName!="select"&&this.shouldPreventEventDefault(b)){b.preventDefault()}this.adjustContentSize(false);this.tracking=true;this.beginTouchesInContentTimer=null;this.touchesInContentBegan=false;this.shouldPreventSelectElementFocus=false;this.contentTouchesCouldNotBeCancelled=false;if(this.delaysContentTouches){this.beginTouchesInContentTimer=this.callMethodNameAfterDelay("beginTouchesInContentIfPermitted",iAd.ScrollView.CONTENT_TOUCHES_DELAY)}else{this.beginTouchesInContentIfPermitted()}document.addEventListener(iAd.Event.MOVE_EVENT,this,true);document.addEventListener(iAd.Event.END_EVENT,this,true);document.addEventListener(iAd.Event.CANCEL_EVENT,this,true)};iAd.ScrollView.prototype.stopTrackingTouches=function(){if(!this._tracking){return}this.tracking=false;document.removeEventListener(iAd.Event.MOVE_EVENT,this,true);document.removeEventListener(iAd.Event.END_EVENT,this,true);document.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);window.clearTimeout(this.beginTouchesInContentTimer)};iAd.ScrollView.prototype.interruptTrackingInteraction=function(a){this.contentTouchesCouldNotBeCancelled=a;if(this.dragging){this.dragging=false;this.snapContentOffsetToBounds(true);this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);this.hideScrollIndicators()}};iAd.ScrollView.prototype.isOriginalTargetElementAtPoint=function(a){return(this.originalTarget===document.elementFromPoint(a.x,a.y))};iAd.ScrollView.prototype.beginTouchesInContentIfPermitted=function(){if(this.scrollEnabled&&this.touchesShouldBeginInContentElementAndView(this.originalStartEvent,this.originalTarget,iAd.View.nearestViewForElement(this.originalTarget))){this.beginTouchesInContent()}};iAd.ScrollView.prototype.beginTouchesInContent=function(){if(this.isContentInEnabledChildScrollView()){return}this.touchesInContentBegan=true;this.dispatchUIEventToContent(iAd.Event.START_EVENT,this.originalStartEvent);if(!this.canCancelContentTouches){this.interruptTrackingInteraction(true)}};iAd.ScrollView.prototype.endTouchesInContent=function(){this.dispatchUIEventToContent(iAd.Event.END_EVENT,this.originalEndEvent);if(this.elementShouldReceiveFocus(this.originalTarget)){this.originalTarget.focus()}};iAd.ScrollView.prototype.touchesShouldBeginInContentElementAndView=function(c,b,a){return true};iAd.ScrollView.prototype.cancelTouchesInContent=function(){var a=document.createEvent("Event");a.initEvent(iAd.Event.CANCEL_EVENT,true,true);a._synthetic=true;this.originalTarget.dispatchEvent(a);window.clearTimeout(this.beginTouchesInContentTimer)};iAd.ScrollView.prototype.touchesShouldCancelInContentElementAndView=function(b,a){return !(iAd.Control.isNodeInControlHierarchyBoundedByElement(b,this.hostingLayer))};iAd.ScrollView.prototype.isContentInEnabledChildScrollView=function(){var b,a=this.scrollViews;for(var c=0,d=a.length;c<d;c++){b=a[c];if(b.scrollEnabled&&b.originalTarget===this.originalTarget){return true}}return false};iAd.ScrollView.prototype.dispatchTapSequenceToContent=function(){this.dispatchUIEventToContent(iAd.Event.START_EVENT,this.originalStartEvent);this.endTouchesInContent()};iAd.ScrollView.prototype.dispatchUIEventToContent=function(b,a){var c=iAd.Event.createUIEvent(b,a);c._synthetic=true;this.originalTarget.dispatchEvent(c)};iAd.ScrollView.prototype.elementShouldReceiveFocus=function(b){var a=b.nodeName.toLowerCase();return(a=="input"&&iAd.ScrollView.TEXT_FIELD_INPUT_TYPES.indexOf(b.type)!=-1)||a=="textarea"};iAd.ScrollView.prototype.dispatchClickToContent=function(){if(!iAd.Event.SUPPORTS_TOUCHES){return}var a=this.getInitialTouch(this.originalStartEvent);if(a==null){return}var b=document.createEvent("MouseEvent");b.initMouseEvent("click",true,true,document.defaultView,0,a.screenX,a.screenY,a.clientX,a.clientY,0,0,0,0,0,0,null);b._synthetic=true;this.originalTarget.dispatchEvent(b)};iAd.ScrollView.prototype.transitionEnded=function(a){if(this.scrollIndicatorsNeedFlashing&&a.currentTarget===this.layer){this.scrollIndicatorsNeedFlashing=false;this.flashScrollIndicators()}if(this.scrollTransitionsNeedRemoval&&a.currentTarget===this.hostingLayer){this.scrollTransitionsNeedRemoval=false;this.hostingLayer.style.webkitTransitionDuration=0;this.didScroll(true)}};iAd.ScrollView.prototype.didScroll=function(a){if(a){this.dispatchNotification(iAd.ScrollView.DID_END_SCROLLING_ANIMATION,this.delegate)}this.dispatchNotification(iAd.ScrollView.DID_SCROLL,this.delegate)};iAd.ScrollView.prototype.startDecelerationAnimation=function(){if(this.bounces&&(this._contentOffset.x>this.maxPoint.x||this._contentOffset.x<0)&&(this._contentOffset.y>this.maxPoint.y||this._contentOffset.y<0)){return}this.decelerationVelocity=this.panGestureRecognizer.velocityInView();this.decelerationVelocity.x=-this.decelerationVelocity.x;this.decelerationVelocity.y=-this.decelerationVelocity.y;this.adjustedDecelerationFactor=new iAd.Size(iAd.ScrollView.DECELERATION_FRICTION_FACTOR,iAd.ScrollView.DECELERATION_FRICTION_FACTOR);if(!this.canScrollVertically){this.decelerationVelocity.y=0}if(!this.canScrollHorizontally){this.decelerationVelocity.x=0}this.minDecelerationPoint=new iAd.Point(0,0);this.maxDecelerationPoint=this.maxPoint.copy();if(this.pagingEnabled){var a=this.pageSize;this.minDecelerationPoint.x=Math.max(0,Math.floor(this._contentOffset.x/a.width)*a.width);this.minDecelerationPoint.y=Math.max(0,Math.floor(this._contentOffset.y/a.height)*a.height);this.maxDecelerationPoint.x=Math.min(this.maxPoint.x,Math.ceil(this._contentOffset.x/a.width)*a.width);this.maxDecelerationPoint.y=Math.min(this.maxPoint.y,Math.ceil(this._contentOffset.y/a.height)*a.height)}var b=this.pagingEnabled?iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION_WITH_PAGING:iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION;if(Math.abs(this.decelerationVelocity.x)>b||Math.abs(this.decelerationVelocity.y)>b){this.decelerating=true;if(this.pagingEnabled){this.nextPageContentOffset=new iAd.Point((this.decelerationVelocity.x>0)?this.maxDecelerationPoint.x:this.minDecelerationPoint.x,(this.decelerationVelocity.y>0)?this.maxDecelerationPoint.y:this.minDecelerationPoint.y)}else{if(iAd.Utils.objectHasMethod(this.delegate,iAd.ScrollView.WILL_END_DRAGGING)){this.adjustedDecelerationParameters()}}this.animatedContentOffset=this._contentOffset.copy();this.decelerationTimer=this.callMethodNameAfterDelay("stepThroughDecelerationAnimation",iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE);this.previousDecelerationFrame=new Date();this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_DECELERATING,this.delegate)}};iAd.ScrollView.prototype.adjustedDecelerationParameters=function(){var b=new iAd.Point(this.decelerationVelocity.x/1000,this.decelerationVelocity.y/1000);var a=new iAd.Point((this.decelerationVelocity.x<0?-iAd.ScrollView.MINIMUM_VELOCITY:iAd.ScrollView.MINIMUM_VELOCITY)/1000,(this.decelerationVelocity.y<0?-iAd.ScrollView.MINIMUM_VELOCITY:iAd.ScrollView.MINIMUM_VELOCITY)/1000);var d=Math.log(iAd.ScrollView.DECELERATION_FRICTION_FACTOR);var c=new iAd.Point(this._contentOffset.x-(b.x-a.x)/d,this._contentOffset.y-(b.y-a.y)/d);c.x=iAd.Number.clampValue(c.x,this.minDecelerationPoint.x,this.maxDecelerationPoint.x);c.y=iAd.Number.clampValue(c.y,this.minDecelerationPoint.y,this.maxDecelerationPoint.y);var f=c.copy();this.delegate[iAd.ScrollView.WILL_END_DRAGGING](this,b,c);if(f.equals(c)){return}var e=new iAd.Point(c.x-this._contentOffset.x,c.y-this._contentOffset.y);if((b.x<=0&&c.x<f.x)||(b.x>=0&&c.x>f.x)){this.decelerationVelocity.x=(a.x-d*e.x)*1000}else{this.adjustedDecelerationFactor.width=Math.min(iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION,Math.exp(-(b.x-a.x)/e.x))}if((b.y<=0&&c.y<f.y)||(b.y>=0&&c.y>f.y)){this.decelerationVelocity.y=(a.y-d*e.y)*1000}else{this.adjustedDecelerationFactor.height=Math.min(iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION,Math.exp(-(b.y-a.y)/e.y))}};iAd.ScrollView.prototype.stopDecelerationAnimation=function(){this.decelerating=false;clearTimeout(this.decelerationTimer)};iAd.ScrollView.prototype.stepThroughDecelerationAnimation=function(){if(!this.decelerating){return}var b=new Date();var f=b-this.previousDecelerationFrame;var g=this.animatedContentOffset.copy();if(this.pagingEnabled){for(var h=0;h<f;h++){this.decelerationVelocity.x+=1000*(iAd.ScrollView.PAGING_ACCELERATION*(this.nextPageContentOffset.x-g.x));this.decelerationVelocity.x*=iAd.ScrollView.PAGING_DECELERATION;g.x=g.x+(this.decelerationVelocity.x/1000);this.decelerationVelocity.y+=1000*(iAd.ScrollView.PAGING_ACCELERATION*(this.nextPageContentOffset.y-g.y));this.decelerationVelocity.y*=iAd.ScrollView.PAGING_DECELERATION;g.y=g.y+(this.decelerationVelocity.y/1000)}}else{var m=this.adjustedDecelerationFactor;var n=new iAd.Size(Math.exp(Math.log(m.width)*f),Math.exp(Math.log(m.height)*f));var l=new iAd.Size(m.width*((1-n.width)/(1-m.width)),m.height*((1-n.height)/(1-m.height)));g.x+=(this.decelerationVelocity.x/1000)*l.width;g.y+=(this.decelerationVelocity.y/1000)*l.height;this.decelerationVelocity.x*=n.width;this.decelerationVelocity.y*=n.height}if(!this.bounces){var e=iAd.Number.clampValue(g.x,0,this.maxPoint.x);if(e!=g.x){g.x=e;this.decelerationVelocity.x=0}var c=iAd.Number.clampValue(g.y,0,this.maxPoint.y);if(c!=g.y){g.y=c;this.decelerationVelocity.y=0}}this.animatedContentOffset=g;if(this._contentOffset.x!=iAd.CSS.roundedPxValue(g.x)||this._contentOffset.y!=iAd.CSS.roundedPxValue(g.y)){this.contentOffset=g}var d=Math.abs(this.decelerationVelocity.x);var k=Math.abs(this.decelerationVelocity.y);var a=(d<=iAd.ScrollView.MINIMUM_VELOCITY&&k<=iAd.ScrollView.MINIMUM_VELOCITY);var o=(!this.pagingEnabled&&a);var j=this.pagingEnabled&&a&&(Math.abs(this.nextPageContentOffset.x-g.x)<=1)&&(Math.abs(this.nextPageContentOffset.y-g.y)<=1);if(o||j){this.decelerationAnimationCompleted();return}if(!this.pagingEnabled&&this.bounces){var p=new iAd.Point(0,0);if(g.x<this.minDecelerationPoint.x){p.x=this.minDecelerationPoint.x-g.x}else{if(g.x>this.maxDecelerationPoint.x){p.x=this.maxDecelerationPoint.x-g.x}}if(g.y<this.minDecelerationPoint.y){p.y=this.minDecelerationPoint.y-g.y}else{if(g.y>this.maxDecelerationPoint.y){p.y=this.maxDecelerationPoint.y-g.y}}if(p.x!=0){if(p.x*this.decelerationVelocity.x<=0){this.decelerationVelocity.x+=p.x*iAd.ScrollView.PENETRATION_DECELERATION}else{this.decelerationVelocity.x=p.x*iAd.ScrollView.PENETRATION_ACCELERATION}}if(p.y!=0){if(p.y*this.decelerationVelocity.y<=0){this.decelerationVelocity.y+=p.y*iAd.ScrollView.PENETRATION_DECELERATION}else{this.decelerationVelocity.y=p.y*iAd.ScrollView.PENETRATION_ACCELERATION}}}this.decelerationTimer=this.callMethodNameAfterDelay("stepThroughDecelerationAnimation",iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE);this.previousDecelerationFrame=b};iAd.ScrollView.prototype.decelerationAnimationCompleted=function(){this.stopDecelerationAnimation();this.hideScrollIndicators();if(this.pagingEnabled){var a=this.pageSize;this.setContentOffsetAnimated(new iAd.Point(Math.round(this._contentOffset.x/a.width)*a.width,Math.round(this._contentOffset.y/a.height)*a.height),false)}this.snapContentOffsetToBounds(false);this.dispatchNotification(iAd.ScrollView.DID_END_DECELERATING,this.delegate)};iAd.ScrollView.isViewInNativeScrollView=function(a){var b=iAd.ScrollViewPanGestureRecognizer.parentScrollViewForView(a);if(b){return b.usesNativeScrolling||iAd.ScrollView.isViewInNativeScrollView(b)}return false};iAd.ScrollView.viewHasTrackingNativeChildScrollView=function(a){var d=a.scrollViews;for(var b=0,c=d.length;b<c;b++){if(d[b].usesNativeScrolling&&d[b].tracking){return true}}return false};