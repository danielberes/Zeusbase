
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.NavigationController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","topViewController","visibleViewController","navigationBarHidden","toolbar","navigationBar","toolbarHidden"],archivedProperties:["viewControllers","navigationBarHidden","toolbarHidden","autoReversesTransitions"]});iAd.NavigationController.WILL_SHOW_VIEW_CONTROLLER="navigationControllerWillShowViewControllerAnimated";iAd.NavigationController.DID_SHOW_VIEW_CONTROLLER="navigationControllerDidShowViewControllerAnimated";iAd.NavigationController.HIDE_SHOW_BAR_DURATION=0.2;iAd.NavigationController.POPOVER_OFFSET=6;iAd.NavigationController.prototype.init=function(b,a){this.callSuper(b);this.delegate=null;this._viewControllers=[];this.autoReversesTransitions=false;this.shouldAnimateInitialViewController=false;this.previousController=null;this.viewAppearancePropagationProperty="visibleViewController";this.shouldArchiveView=false;this.delayedSetOperationArguments=null;this.backingTransitionController=new iAd.TransitionController();this.backingTransitionController.delegate=this;this._navigationBarHidden=false;this._toolbarHidden=true;this._navigationBar=null;this._toolbar=null;this.requiresDeferredHostViewSizeUpdate=false;if(a!=null){this.viewControllers=[a]}};iAd.NavigationController.prototype.loadView=function(){var a=new iAd.NavigationView(this);this.view=a;a.layer.addClassName("ad-navigation-controller-view");a.size=new iAd.Size(window.innerWidth,window.innerHeight);a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;a.clipsToBounds=true;if(!this._navigationBarHidden&&this.navigationBar){a.addSubview(this.navigationBar)}this.hostView=a.addSubview(this.backingTransitionController.view);this.hostView.layer.addClassName("ad-navigation-controller-host-view");if(!this._toolbarHidden&&this.toolbar){a.addSubview(this.toolbar)}a.addPropertyObserver("size",this,"sizeChanged");this.sizeChanged();this.performDelayedSetOperation();var b=this.topViewController?this.topViewController.view:null;if(b&&b.superview!=this.hostView){b.size=this.hostView.size.copy();b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.hostView.addSubview(b)}a.layer.addEventListener(iAd.SpatialNavigationManager.NAVIGATE_EVENT,this,false)};iAd.NavigationController.prototype.viewMovedToNewSuperview=function(){var a=this._navigationBar;if(!a){return}var b=a.topItem;if(b!=null){b.updateLayoutIfTopItem()}};iAd.NavigationController.prototype.unloadView=function(){if(this.hostView){this.hostView.removeFromSuperview();this.hostView=null}if(this._toolbar){this._toolbar.removeFromSuperview();this._toolbar=null}if(this._navigationBar){this._navigationBar.removeFromSuperview();this._navigationBar=null}this.callSuper()};iAd.NavigationController.prototype.didReceiveMemoryWarning=function(){this.callSuper();var b=this._viewControllers.length-(this._view?2:0);for(var a=0;a<b;a++){this._viewControllers[a].unloadView()}};iAd.NavigationController.prototype.handleEvent=function(a){if(iAd.SpatialNavigationManager&&a.type==iAd.SpatialNavigationManager.NAVIGATE_EVENT){if(a.ad.command==iAd.Event.KEYBOARD_BACKSPACE){this.popViewControllerAnimated(true);a.preventDefault()}}else{this.callSuper(a)}};iAd.NavigationController.prototype.getNavigationBar=function(){var a=this._navigationBar;if(!a){if(!iAd.NavigationBar){iAd.Console.warn("iAd.NavigationController: Attempting to create a navigation bar but iAd.NavigationBar is undefined; navigationBarHidden will be set to true. You must explicitly require iAd.NavigationBar in your project.");this._navigationBarHidden=true;return null}var a=this._navigationBar=new iAd.NavigationBar();a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;if(this.isViewLoaded()){a.size=new iAd.Size(this.view.size.width,iAd.NavigationBar.DEFAULT_HEIGHT)}}return a};iAd.NavigationController.prototype.getToolbar=function(){var a=this._toolbar;if(!a){if(!iAd.Toolbar){iAd.Console.warn("iAd.NavigationController: Attempting to create a toolbar but iAd.Toolbar is undefined; toolbarHidden will be set to true. You must explicitly require iAd.Toolbar in your project.");this._toolbarHidden=true;return null}var a=this._toolbar=new iAd.Toolbar();a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;if(this.isViewLoaded()){a.size=new iAd.Size(this.view.size.width,iAd.Toolbar.DEFAULT_HEIGHT)}}return a};iAd.NavigationController.prototype.getTopViewController=function(){return(this.viewControllers.length>0)?this.viewControllers[this.viewControllers.length-1]:null};iAd.NavigationController.prototype.getVisibleViewController=function(){var a=this.topViewController;return a.modalViewController||a};iAd.NavigationController.prototype.getViewControllers=function(){return(this.delayedSetOperationArguments!=null)?this.delayedSetOperationArguments[0]:this._viewControllers};iAd.NavigationController.prototype.setViewControllers=function(a){this.setViewControllersAnimated(a,false)};iAd.NavigationController.prototype.setViewControllersAnimated=function(g,e){if(g.length==0){return}if(this.shouldDelaySetOperation()){this.delayedSetOperationArguments=arguments;return}iAd.Transaction.begin();var f=(this._viewControllers.length>0)?this._viewControllers[this._viewControllers.length-1]:null;var a=g[g.length-1];var h=(this._viewControllers.indexOf(a)!=-1);var c=(!f&&e)?this.shouldAnimateInitialViewController:e;this.dispatchWillShowNotification(a,c);for(var b=0,d=this._viewControllers.length;b<d;b++){this._viewControllers[b].parentViewController=null}for(var b=0,d=g.length;b<d;b++){g[b].parentViewController=this}this._viewControllers=g;this.prepareViewControllersForTransition(f,a,h);this.backingTransitionController.setVisibleViewControllerAnimated(a,c);iAd.Transaction.commit()};iAd.NavigationController.prototype.prepareViewControllersForTransition=function(b,c,a){if(b==null){c.becomesVisibleTransition=c.becomesTopItemTransition}else{if(b!==c){if(this.autoReversesTransitions){b.becomesHiddenTransition=a?b.wasTopItemTransition:c.becomesBackItemTransition;c.becomesVisibleTransition=a?b.wasBackItemTransition:c.becomesTopItemTransition}else{b.becomesHiddenTransition=a?b.wasTopItemTransition:b.becomesBackItemTransition;c.becomesVisibleTransition=a?c.wasBackItemTransition:c.becomesTopItemTransition}}}c.view.size=this.hostView.size.copy();c.view.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT};iAd.NavigationController.prototype.shouldDelaySetOperation=function(){return !this.isViewLoaded()||this.backingTransitionController.busy||(!this.navigationBarHidden&&this.navigationBar.busy)};iAd.NavigationController.prototype.pushViewControllerAnimated=function(a,b){if(this.viewControllers.indexOf(a)!=-1){iAd.Console.warn("iAd.NavigationController.prototype.pushViewControllerAnimated: attempt to push a view controller already in the stack");return}this.setViewControllersAnimated(this.viewControllers.concat([a]),b)};iAd.NavigationController.prototype.popViewControllerAnimated=function(b){if(this.viewControllers.length>1){var a=this.topViewController;this.setViewControllersAnimated(this.viewControllers.slice(0,this.viewControllers.length-1),b);return a}return null};iAd.NavigationController.prototype.popToRootViewControllerAnimated=function(a){return this.popToViewControllerAnimated(this.viewControllers[0],a)};iAd.NavigationController.prototype.popToViewControllerAnimated=function(a,c){var d=this.viewControllers.indexOf(a);if(d<0||d>=this.viewControllers.length-1){return[]}var b=this.viewControllers.slice(d+1);this.setViewControllersAnimated(this.viewControllers.slice(0,d+1),c);return b};iAd.NavigationController.prototype.transitionControllerWillMakeViewControllerVisibleAnimated=function(d,b,c,e){var a=this._navigationBar;if(a){var h=[];for(var f=0,g=this._viewControllers.length;f<g;f++){h.push(this._viewControllers[f].navigationItem)}a.setItemsAnimated(h,this.navigationBarHidden?false:e)}var j=this._toolbar;if(j){j.setItemsAnimated(b.toolbarItems,e)}};iAd.NavigationController.prototype.transitionControllerDidMakeViewControllerVisibleAnimated=function(b,d,a,c){this.dispatchDidShowNotification(d,c);this.performDelayedSetOperation()};iAd.NavigationController.prototype.dispatchDidShowNotification=function(b,a){this.dispatchNotification(iAd.NavigationController.DID_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",b],["animated",a]])};iAd.NavigationController.prototype.dispatchWillShowNotification=function(b,a){this.dispatchNotification(iAd.NavigationController.WILL_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",b],["animated",a]])};iAd.NavigationController.prototype.performDelayedSetOperation=function(){if(this.delayedSetOperationArguments==null){return}if(this._navigationBar&&this.navigationBar.busy){this.navigationBar.addPropertyObserver("busy",this,"navigationBarBusyStateChanged")}else{this.setViewControllersAnimated(this.delayedSetOperationArguments[0],this.delayedSetOperationArguments[1]);this.delayedSetOperationArguments=null}};iAd.NavigationController.prototype.navigationBarBusyStateChanged=function(){if(this._navigationBar&&this.navigationBar.busy){return}this.navigationBar.removePropertyObserver("busy",this,"navigationBarBusyStateChanged");this.performDelayedSetOperation()};iAd.NavigationController.prototype.sizeChanged=function(){var d=this.hostedInPopoverController();var c=iAd.NavigationBar?-iAd.NavigationBar.DEFAULT_HEIGHT:0;var b=0;var f=this._view.size.height;if(!this._navigationBarHidden){c=d?-iAd.NavigationController.POPOVER_OFFSET:0;b+=iAd.NavigationBar.DEFAULT_HEIGHT-(d?iAd.NavigationController.POPOVER_OFFSET:0)}if(!this._toolbarHidden){f-=iAd.Toolbar.DEFAULT_HEIGHT-(d?iAd.NavigationController.POPOVER_OFFSET+1:0)}this.hostView.position=new iAd.Point(0,b);var a=this._navigationBar;if(a){a.position=new iAd.Point(0,c)}var e=this._toolbar;if(e){this.toolbar.position=new iAd.Point(0,f)}this.updateHostViewSize()};iAd.NavigationController.prototype.updateHostViewSize=function(){var a=this._view.size.height;var b=this.hostedInPopoverController();if(!this._navigationBarHidden){a-=iAd.NavigationBar.DEFAULT_HEIGHT-(b?iAd.NavigationController.POPOVER_OFFSET:0)}if(!this._toolbarHidden){a-=iAd.Toolbar.DEFAULT_HEIGHT-(b?iAd.NavigationController.POPOVER_OFFSET:0)}this.hostView.size=new iAd.Size(this._view.size.width,a)};iAd.NavigationController.prototype.hostedInPopoverController=function(){return iAd.Utils.objectIsInstanceOfClass(this.parentViewController,iAd.PopoverController)};iAd.NavigationController.prototype.setNavigationBarHidden=function(a){this.setNavigationBarHiddenAnimated(a,false)};iAd.NavigationController.prototype.setNavigationBarHiddenAnimated=function(f,e){if(this._navigationBarHidden==f){return}this._navigationBarHidden=f;if(!this.isViewLoaded()){return}var a=this._navigationBar;if(!a&&f){return}var c=this.hostedInPopoverController();var b=new iAd.Point(0,f?-iAd.NavigationBar.DEFAULT_HEIGHT:(c?-iAd.NavigationController.POPOVER_OFFSET:0));var d=new iAd.Point(0,f?0:iAd.NavigationBar.DEFAULT_HEIGHT-(c?iAd.NavigationController.POPOVER_OFFSET:0));if(!f){this.view.addSubview(this.navigationBar)}if(!e){a.position=b;this.hostView.position=d;this.updateHostViewSize();if(f){a.removeFromSuperview()}return}iAd.Transaction.begin();iAd.Transaction.defaults.duration=e?iAd.NavigationController.HIDE_SHOW_BAR_DURATION:0;iAd.Transaction.defaults.properties=["position"];a.applyTransition({to:[b],removesTargetUponCompletion:f});this.hostView.applyTransition({to:[d],delegate:this});iAd.Transaction.commit();if(f){this.updateHostViewSize()}else{this.requiresDeferredHostViewSizeUpdate=true}};iAd.NavigationController.prototype.transitionDidComplete=function(a){if(this.requiresDeferredHostViewSizeUpdate){this.requiresDeferredHostViewSizeUpdate=false;this.updateHostViewSize()}};iAd.NavigationController.prototype.setToolbarHidden=function(a){this.setToolbarHiddenAnimated(a,false)};iAd.NavigationController.prototype.setToolbarHiddenAnimated=function(b,a){if(this._toolbarHidden==b){return}this._toolbarHidden=b;if(!this.isViewLoaded()){return}if(!this._toolbar&&b){return}var c=new iAd.Point(0,this._view.size.height-(b?0:iAd.Toolbar.DEFAULT_HEIGHT));if(this.hostedInPopoverController()){c.y+=iAd.NavigationController.POPOVER_OFFSET}if(!b){this.view.addSubview(this.toolbar)}if(!a){this.toolbar.position=c;this.updateHostViewSize();if(b){this.toolbar.removeFromSuperview()}return}new iAd.Transition({target:this.toolbar,properties:["position"],to:[c],duration:a?iAd.NavigationController.HIDE_SHOW_BAR_DURATION:0,delegate:this,removesTargetUponCompletion:b}).start();if(b){this.updateHostViewSize()}else{this.requiresDeferredHostViewSizeUpdate=true}this.notifyPropertyChange("toolbarHidden")};iAd.Class({name:"iAd.NavigationView",superclass:iAd.View});iAd.NavigationView.prototype.init=function(a){this.callSuper();this.viewController=a};iAd.NavigationView.prototype.didMoveToSuperview=function(a){this.callSuper(a);if(a!=null){this.viewController.viewMovedToNewSuperview()}};iAd.ViewController.prototype.getNavigationController=function(){return this.parentControllerOfKind(iAd.NavigationController)};iAd.ViewController.prototype.getNavigationItem=function(){if(this._navigationItem==null){this._navigationItem=new iAd.NavigationItem(this.title);this._navigationItem.viewController=this}return this._navigationItem};iAd.ViewController.prototype.setToolbarItems=function(a){this.setToolbarItemsAnimated(a,false)};iAd.ViewController.prototype.setToolbarItemsAnimated=function(b,c){if(!b){return}this._toolbarItems=b;var a=this.parentViewController;if(a!=null&&a instanceof iAd.NavigationController){a.toolbar.setItemsAnimated(b,c)}};iAd.Class.synthesizeProperties(iAd.ViewController,["navigationController","navigationItem","toolbarItems"]);iAd.Class.processMethods(iAd.ViewController,["setToolbarItemsAnimated"]);iAd.RootViewController.prototype.getNavigationController=function(){if(!this.hasOwnProperty("_navigationController")){this.navigationController=new iAd.NavigationController()}return this._navigationController};iAd.RootViewController.prototype.setNavigationController=function(b){b.navigationBarHidden=true;b.shouldAnimateInitialViewController=true;b.delegate=this;var a=this.view;b.view.size=a._size.copy();a.addSubview(b.view);this._navigationController=b};iAd.Class.synthesizeProperties(iAd.RootViewController,["navigationController"]);